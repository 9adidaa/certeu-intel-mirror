{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2017-006.pdf"
  },
  "title": "UPDATE Critical Cisco CMP Remote Code Execution Vulnerability",
  "serial_number": "2017-006",
  "publish_date": "21-03-2017 10:44:00",
  "description": "Cisco security researchers found a vulnerability in the Cluster Management Protocol (CMP) code in Cisco IOS and Cisco IOS XE software that could allow an unauthenticated, remote attacker to cause a reload of an affected device or remotely execute code with elevated privileges. Cisco has now released a software fix for this vulnerability.",
  "url_title": "2017-006",
  "content_markdown": "---\ntitle: 'Critical Cisco CMP Remote Code Execution Vulnerability'\nversion: '1.1'\nnumber: '2017-006'\ndate: 'May 11, 2017'\n---\n\n_History:_\n\n* _21/03/2017 --- v1.0: Initial publication_\n* _11/05/2017 --- v1.1: Software update available from CISCO_\n\n# Summary\n\nOn March 7th, 2017, Wikileaks made public a set of documents that is being referred to as the _Vault 7 leak_. Based on the _Vault 7_ data, Cisco launched an investigation [2] into the products that could potentially be impacted by these and similar exploits and vulnerabilities. As part of the internal investigation of their products and the publicly available information, Cisco security researchers found a vulnerability [1, 5] in the Cluster Management Protocol (CMP) code in Cisco IOS and Cisco IOS XE software that could allow an unauthenticated, remote attacker to cause a reload of an affected device or remotely execute code with elevated privileges.\n\nCisco has now released a software fix for this vulnerability.\n\n# Technical Details\n\nThe Cluster Management Protocol (CMP) utilizes internally **telnet** as a signaling and command protocol between cluster members. CMP/IP is the transport mechanism to exchange management packets between the command switch and member switches. The vulnerability is due to the combination of two factors:\n\n* the failure to restrict the use of CMP-specific telnet options only to internal, local communications between cluster members, and instead accept and process such options over any telnet connection to an affected device, and\n* the incorrect processing of malformed CMP-specific telnet options.\n\nAn attacker could exploit this vulnerability by sending malformed CMP-specific telnet options while establishing a telnet session with an affected Cisco device configured to accept telnet connections. An exploit could allow an attacker to execute arbitrary code and obtain full control of the device or cause a reload of the affected device.\n\n# Products Affected\n\nThe vulnerability affects:\n\n* Catalyst switches,\n* Embedded Service 2020 switches,\n* Enhanced Layer 2 EtherSwitch Service Module,\n* Enhanced Layer 2/3 EtherSwitch Service Module,\n* Gigabit Ethernet Switch Module (CGESM) for HP,\n* IE Industrial Ethernet switches,\n* ME 4924-10GE switch, RF Gateway 10,\n* SM-X Layer 2/3 EtherSwitch Service Module\n\nAn extensive list (300+) of affected devices^[Considering the number of affected devices reported by Cisco in [1], it is envisagable that other older -- no longer officially supported devices -- may also be affected by this vulnerability, so the list may be not-exhaustive.] can be found in [1].\n\nThe vulnerability affects Cisco devices running Cisco IOS and IOS XE. Cisco devices running a vulnerable Cisco IOS XE release are affected by this vulnerability when the following conditions are met:\n\n* the CMP subsystem is present on the Cisco IOS XE software image running on the device,\n* the device is configured to accept incoming telnet connections.\n\nIn Cisco IOS XE, in order to determine if the CMP subsystem is present on the running software image, execute the command `show subsys class protocol | include ^cmp` from a privileged CLI prompt on the device.\n\nThe following example shows the output of this command when the CMP subsystem is present on the software image running on the device:\n\n\t#show subsys class protocol | include ^cmp\n\tcmp                                Protocol    1.000.001\n\n\nIf the output of the command is empty then CMP subsystem is **not** present on the running software image.\n\nIn order to determine if the device is configured to accept incoming telnet connections, execute the command `show running-config | include ^line vty|transport input` from a privileged CLI prompt.\n\nBe sure that the `transport input` configuration line after the line `vty` configuration line is present and configured to only accept the Secure Shell (SSH) protocol for incoming connections to **all** the available VTYs like the example below:\n\n\t#show running-config | include ^line vty|transport input\n\tline vty 0 4\n\t transport input ssh\n\tline vty 5 15\n\t transport input ssh\n\n\\clearpage\n\nThe following configuration lines show examples of a vulnerable software version:\n\n\tline vty 6 15\n\n\tline vty 0 4\n\t transport input all\n\tline vty 0 4\n\t \t transport input ssh\n\tline vty 5\n\t transport input ssh\n\tline vty 6 15 (default=vulnerable)\n\n# Recommendations\n\nCisco has released software updates that address this vulnerability [1].\n\nAdditionally, as a mitigation to this vulnerability, follow Cisco best practices replacing the **telnet** protocol with the **SSH** protocol as an allowed protocol for incoming connections, thus eliminating the exploit vector. Information on how to implement it can be found on the Cisco Guide to Harden Cisco IOS Devices [3]. In case the SSH protocol is not available in the specific IOS version used, upgrade the IOS version to one that supports it.\n\nIn case SSH cannot be used and telnet has to be allowed, a measure that can reduce the attack surface is to implement Infrastructure Access Control Lists (iACLs). Information on iACLs can be found on the following Cisco document: _Protecting Your Core: Infrastructure Protection Access Control Lists_ [4].\n\nCisco IPS Signature 7880-0 and Snort SIDs 41909 and 41910 can also be used to detect attempts to exploit this vulnerability.\n\n**_NOTE:_** _Since only limited amount of information is available with regard to this vulnerability and no specific details of the software update is provided, it is strongly recommended to monitor the network traffic using the above mentioned Cisco IPS signature and Snort rules._\n\nFinally, it is important to realize that even after a patch is published by Cisco, it is useful to re-assess the need to use the CMP. It appears that the CMP will always use telnet for remote management. Given that there is no separation of the _control_ and the _data_ plane in a lot of switches (that eventually changes with the new models), it is advisable to avoid clustering altogether.\n\n# References\n\n[1] <https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170317-cmp>\n\n[2] <https://blogs.cisco.com/security/the-wikileaks-vault-7-leak-what-we-know-so-far>\n\n[3] <https://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html>\n\n[4] <https://www.cisco.com/c/en/us/support/docs/ip/access-lists/43920-iacl.html>\n\n[5] <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-3881>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>21/03/2017 --- v1.0: Initial publication</em></li><li><em>11/05/2017 --- v1.1: Software update available from CISCO</em></li></ul><h2 id=\"summary\">Summary</h2><p>On March 7th, 2017, Wikileaks made public a set of documents that is being referred to as the <em>Vault 7 leak</em>. Based on the <em>Vault 7</em> data, Cisco launched an investigation [2] into the products that could potentially be impacted by these and similar exploits and vulnerabilities. As part of the internal investigation of their products and the publicly available information, Cisco security researchers found a vulnerability [1, 5] in the Cluster Management Protocol (CMP) code in Cisco IOS and Cisco IOS XE software that could allow an unauthenticated, remote attacker to cause a reload of an affected device or remotely execute code with elevated privileges.</p><p>Cisco has now released a software fix for this vulnerability.</p><h2 id=\"technical-details\">Technical Details</h2><p>The Cluster Management Protocol (CMP) utilizes internally <strong>telnet</strong> as a signaling and command protocol between cluster members. CMP/IP is the transport mechanism to exchange management packets between the command switch and member switches. The vulnerability is due to the combination of two factors:</p><ul><li>the failure to restrict the use of CMP-specific telnet options only to internal, local communications between cluster members, and instead accept and process such options over any telnet connection to an affected device, and</li><li>the incorrect processing of malformed CMP-specific telnet options.</li></ul><p>An attacker could exploit this vulnerability by sending malformed CMP-specific telnet options while establishing a telnet session with an affected Cisco device configured to accept telnet connections. An exploit could allow an attacker to execute arbitrary code and obtain full control of the device or cause a reload of the affected device.</p><h2 id=\"products-affected\">Products Affected</h2><p>The vulnerability affects:</p><ul><li>Catalyst switches,</li><li>Embedded Service 2020 switches,</li><li>Enhanced Layer 2 EtherSwitch Service Module,</li><li>Enhanced Layer 2/3 EtherSwitch Service Module,</li><li>Gigabit Ethernet Switch Module (CGESM) for HP,</li><li>IE Industrial Ethernet switches,</li><li>ME 4924-10GE switch, RF Gateway 10,</li><li>SM-X Layer 2/3 EtherSwitch Service Module</li></ul><p>An extensive list (300+) of affected devices^[Considering the number of affected devices reported by Cisco in [1], it is envisagable that other older -- no longer officially supported devices -- may also be affected by this vulnerability, so the list may be not-exhaustive.] can be found in [1].</p><p>The vulnerability affects Cisco devices running Cisco IOS and IOS XE. Cisco devices running a vulnerable Cisco IOS XE release are affected by this vulnerability when the following conditions are met:</p><ul><li>the CMP subsystem is present on the Cisco IOS XE software image running on the device,</li><li>the device is configured to accept incoming telnet connections.</li></ul><p>In Cisco IOS XE, in order to determine if the CMP subsystem is present on the running software image, execute the command <code>show subsys class protocol | include ^cmp</code> from a privileged CLI prompt on the device.</p><p>The following example shows the output of this command when the CMP subsystem is present on the software image running on the device:</p><pre><code>#show subsys class protocol | include ^cmp\ncmp                                Protocol    1.000.001\n</code></pre><p>If the output of the command is empty then CMP subsystem is <strong>not</strong> present on the running software image.</p><p>In order to determine if the device is configured to accept incoming telnet connections, execute the command <code>show running-config | include ^line vty|transport input</code> from a privileged CLI prompt.</p><p>Be sure that the <code>transport input</code> configuration line after the line <code>vty</code> configuration line is present and configured to only accept the Secure Shell (SSH) protocol for incoming connections to <strong>all</strong> the available VTYs like the example below:</p><pre><code>#show running-config | include ^line vty|transport input\nline vty 0 4\n transport input ssh\nline vty 5 15\n transport input ssh\n</code></pre><p>\\clearpage</p><p>The following configuration lines show examples of a vulnerable software version:</p><pre><code>line vty 6 15\n\nline vty 0 4\n transport input all\nline vty 0 4\n     transport input ssh\nline vty 5\n transport input ssh\nline vty 6 15 (default=vulnerable)\n</code></pre><h2 id=\"recommendations\">Recommendations</h2><p>Cisco has released software updates that address this vulnerability [1].</p><p>Additionally, as a mitigation to this vulnerability, follow Cisco best practices replacing the <strong>telnet</strong> protocol with the <strong>SSH</strong> protocol as an allowed protocol for incoming connections, thus eliminating the exploit vector. Information on how to implement it can be found on the Cisco Guide to Harden Cisco IOS Devices [3]. In case the SSH protocol is not available in the specific IOS version used, upgrade the IOS version to one that supports it.</p><p>In case SSH cannot be used and telnet has to be allowed, a measure that can reduce the attack surface is to implement Infrastructure Access Control Lists (iACLs). Information on iACLs can be found on the following Cisco document: <em>Protecting Your Core: Infrastructure Protection Access Control Lists</em> [4].</p><p>Cisco IPS Signature 7880-0 and Snort SIDs 41909 and 41910 can also be used to detect attempts to exploit this vulnerability.</p><p><strong><em>NOTE:</em></strong> <em>Since only limited amount of information is available with regard to this vulnerability and no specific details of the software update is provided, it is strongly recommended to monitor the network traffic using the above mentioned Cisco IPS signature and Snort rules.</em></p><p>Finally, it is important to realize that even after a patch is published by Cisco, it is useful to re-assess the need to use the CMP. It appears that the CMP will always use telnet for remote management. Given that there is no separation of the <em>control</em> and the <em>data</em> plane in a lot of switches (that eventually changes with the new models), it is advisable to avoid clustering altogether.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170317-cmp\">https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170317-cmp</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://blogs.cisco.com/security/the-wikileaks-vault-7-leak-what-we-know-so-far\">https://blogs.cisco.com/security/the-wikileaks-vault-7-leak-what-we-know-so-far</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html\">https://www.cisco.com/c/en/us/support/docs/ip/access-lists/13608-21.html</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisco.com/c/en/us/support/docs/ip/access-lists/43920-iacl.html\">https://www.cisco.com/c/en/us/support/docs/ip/access-lists/43920-iacl.html</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-3881\">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-3881</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": [
    "CVE-2017-3881"
  ]
}