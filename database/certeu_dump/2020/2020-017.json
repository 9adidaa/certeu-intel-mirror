{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2020-017.pdf"
  },
  "title": "UPDATE: Remote-Code-Execution Vulnerabilities in All Versions of Windows",
  "serial_number": "2020-017",
  "publish_date": "24-03-2020 10:14:00",
  "description": "On the 23th of March 2020, Microsoft released a security advisory for two remote-code-execution vulnerabilities affecting all versions of Windows. The two vulnerabilities are linked to the Adobe Type Manager Library. An attacker could exploit these vulnerabilities by convincing a user to open or preview a specially crafted document.<br>Microsoft is aware of ongoing attacks which could exploit these 0-days vulnerabilities. A patch is not available yet but Microsoft provides advice on workarounds to limit the exploitability of the vulnerabilities.<br>Update: On the 24th of March 2020, Microsoft updated the advisory, explaining that the attack mostly affect Windows 7 and that the vulnerability is not considered as critical for recent Windows 10 systems.",
  "url_title": "2020-017",
  "content_markdown": "---\ntitle: 'Remote-Code-Execution Vulnerabilities in All Versions of Windows'\nversion: '1.3'\nnumber: '2020-017'\ndate: 'March 27, 2020'\n---\n\n_History:_\n\n* _24/03/2020 --- v1.0 -- Initial publication_\n* _25/03/2020 --- v1.1 -- Update regarding lack of impact on recent versions of Windows 10_\n* _26/03/2020 --- v1.2 -- Update with info about `fontdrvhost.exe` in Windows 10 build 1709_\n* _27/03/2020 --- v1.3 -- Clarification and reference to 0patch micropatching for Windows 7_\n\n# Summary\n\nOn the 23th of March 2020, Microsoft released a security advisory for two **remote-code-execution** vulnerabilities **affecting all versions of Windows** [1]. The two vulnerabilities are linked to the **Adobe Type Manager Library**. An attacker could exploit these vulnerabilities by convincing a user to open or preview a specially crafted document.\n\nMicrosoft is aware of **ongoing attacks** which could exploit these 0-days vulnerabilities. A patch is not available yet but Microsoft provides advice on workarounds to limit the exploitability of the vulnerabilities.\n\n**Update:** On the 24th of March 2020, Microsoft updated the advisory, explaining that the attack mostly affect Windows 7 and that **the vulnerability is not considered as critical for recent Windows 10 systems**.\n\n# Technical Details\n\nThe two 0-day vulnerabilities exist in Microsoft Windows when the Windows Adobe Type Manager Library improperly handles a specially-crafted multi-master font -- Adobe Type 1 PostScript format.\n\nAdobe Type Manager (located in `%windir%\\system32\\atmfd.dll`), is a kernel module that is provided by Windows and provides support for OpenType fonts. This kernel module is loaded when a user opens or previews (_Preview Pane_ and _Details Pane_ in Windows Explorer) documents containing OpenType fonts.\n\nThe change in criticality for Windows 10 build 1709 and later [2] is due to the fact that font parsing was moved to `fontdrvhost.exe`, a sandboxed user-space process. `fontdrvhost.exe` likely shares code with `atmfd.dll`, which explains why those system are also vulnerable [3].  However, the attacker will need another vulnerability to escape the `AppContainer` sandbox. Also note that in some cases, the `atmfd.dll` may still be present on the newer system (build 1709 and later), but will not be used for font parsing.\n\nApart from exploiting these vulnerabilities by convincing a user to open or preview a specially crafted document, the vulnerability could also be exploited via the `WebClient` service through a remote WebDAV server.\n\n# Products Affected\n\n* Windows 10 for 32-bit Systems\n* Windows 10 for x64-based Systems\n* Windows 10 Version 1607 for 32-bit Systems\n* Windows 10 Version 1607 for x64-based Systems\n* Windows 10 Version 1709 for 32-bit Systems\n* Windows 10 Version 1709 for ARM64-based Systems\n* Windows 10 Version 1709 for x64-based Systems\n* Windows 10 Version 1803 for 32-bit Systems\n* Windows 10 Version 1803 for ARM64-based Systems\n* Windows 10 Version 1803 for x64-based Systems\n* Windows 10 Version 1809 for 32-bit Systems\n* Windows 10 Version 1809 for ARM64-based Systems\n* Windows 10 Version 1809 for x64-based Systems\n* Windows 10 Version 1903 for 32-bit Systems\n* Windows 10 Version 1903 for ARM64-based Systems\n* Windows 10 Version 1903 for x64-based Systems\n* Windows 10 Version 1909 for 32-bit Systems\n* Windows 10 Version 1909 for ARM64-based Systems\n* Windows 10 Version 1909 for x64-based Systems\n* Windows 7 for 32-bit Systems Service Pack 1\n* Windows 7 for x64-based Systems Service Pack 1\n* Windows 8.1 for 32-bit systems\n* Windows 8.1 for x64-based systems\n* Windows RT 8.1\n* Windows Server 2008 for 32-bit Systems Service Pack 2\n* Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)\n* Windows Server 2008 for Itanium-Based Systems Service Pack 2\n* Windows Server 2008 for x64-based Systems Service Pack 2\n* Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)\n* Windows Server 2008 R2 for Itanium-Based Systems Service Pack 1\n* Windows Server 2008 R2 for x64-based Systems Service Pack 1\n* Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)\n* Windows Server 2012\n* Windows Server 2012 (Server Core installation)\n* Windows Server 2012 R2\n* Windows Server 2012 R2 (Server Core installation)\n* Windows Server 2016\n* Windows Server 2016 (Server Core installation)\n* Windows Server 2019\n* Windows Server 2019 (Server Core installation)\n* Windows Server, version 1803 (Server Core Installation)\n* Windows Server, version 1903 (Server Core installation)\n* Windows Server, version 1909 (Server Core installation)\n\n# Recommendations\n\nMicrosoft has not yet released a patch for this vulnerability. It is recommended to apply workarounds until the patch is available.\n\n## Workarounds Recommended by Microsoft\n\nMicrosoft recommends the following workarounds to limit the scope of the vulnerabilities, especially on versions before Windows 10  build 1709 [1].\n\n### Disable the Preview Pane and Details Pane in Windows Explorer\n\nFor Windows Server 2008, Windows 7, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows 8.1, perform the following steps:\n\n* Open Windows Explorer, click _Organize_, and then click _Layout_.\n* Clear both the _Details pane_ and _Preview pane_ menu options.\n* Click _Organize_, and then click _Folder and search options_.\n* Click the _View_ tab.\n* Under _Advanced settings_, check the _Always show icons, never thumbnails_ box.\n* Close all open instances of Windows Explorer for the change to take effect.\n\nFor Windows Server 2016, Windows 10, and Windows Server 2019, perform the following steps:\n\n* Open Windows Explorer, click the _View_ tab.\n* Clear both the _Details pane_ and _Preview pane_ menu options.\n* Click _Options_, and then click _Change folder and search options_.\n* Click the _View_ tab.\n* Under _Advanced settings_, check the _Always show icons, never thumbnails_ box.\n* Close all open instances of Windows Explorer for the change to take effect.\n\n### Disable the `WebClient` Service\n\nPerform the following steps:\n\n* Click _Start_, click _Run_ (or press the _Windows Key_ and _R_ on the keyboard), type `services.msc` and then click _OK_.\n* Right-click `WebClient` service and select _Properties_.\n* Change the _Startup type_ to _Disabled_. If the service is running, click _Stop_.\n* Click _OK_ and exit the management application.\n\n### Rename `atmfd.dll` (only for systems prior to Windows 10  build 1709)\n\nFor 32-bit systems, enter the following commands at an administrative command prompt and restart the system:\n\n\tcd \"%windir%\\system32\"\n\ttakeown.exe /f atmfd.dll\n\ticacls.exe atmfd.dll /save atmfd.dll.acl\n\ticacls.exe atmfd.dll /grant Administrators:(F)\n\trename atmfd.dll x-atmfd.dll\n\n\nFor 64-bit systems, enter the following commands at an administrative command prompt and restart the system:\n\n\tcd \"%windir%\\system32\"\n\ttakeown.exe /f atmfd.dll\n\ticacls.exe atmfd.dll /save atmfd.dll.acl\n\ticacls.exe atmfd.dll /grant Administrators:(F)\n\trename atmfd.dll x-atmfd.dll\n\tcd \"%windir%\\syswow64\"\n\ttakeown.exe /f atmfd.dll\n\ticacls.exe atmfd.dll /save atmfd.dll.acl\n\ticacls.exe atmfd.dll /grant Administrators:(F)\n\trename atmfd.dll x-atmfd.dll\n\n### Optional Procedure for Windows 8.1 Operating Systems and Below (Disable `ATMFD`)\n\nSet the following registry key:\n\n\tHKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\DisableATMFD, DWORD = 1\n\n## Micropatching\n\nOn 26th of March 2020, 0patch proposed a micropatch for Windows 7 64-bit and Windows Server 2008 R2 without Extended Security Updates (ESU) [4].\n\nThe patch injects in `gdi32.dll` right before the `syscall` instruction to transfer execution to the kernel in function `NtGdiAddFontResourceW`, successfully covering all common execution points that various Windows applications such as Windows Explorer, Font Viewer, and applications use to parse Adobe Type 1 PostScript fonts.\n\n# References\n\n[1] <https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV200006>\n\n[2] <https://twitter.com/DidierStevens/status/1242387445850791937>\n\n[3] <https://twitter.com/DidierStevens/status/1242249023303499777>\n\n[4] <https://blog.0patch.com/2020/03/micropatching-unknown-0days-in-windows.html>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>24/03/2020 --- v1.0 -- Initial publication</em></li><li><em>25/03/2020 --- v1.1 -- Update regarding lack of impact on recent versions of Windows 10</em></li><li><em>26/03/2020 --- v1.2 -- Update with info about <code>fontdrvhost.exe</code> in Windows 10 build 1709</em></li><li><em>27/03/2020 --- v1.3 -- Clarification and reference to 0patch micropatching for Windows 7</em></li></ul><h2 id=\"summary\">Summary</h2><p>On the 23th of March 2020, Microsoft released a security advisory for two <strong>remote-code-execution</strong> vulnerabilities <strong>affecting all versions of Windows</strong> [1]. The two vulnerabilities are linked to the <strong>Adobe Type Manager Library</strong>. An attacker could exploit these vulnerabilities by convincing a user to open or preview a specially crafted document.</p><p>Microsoft is aware of <strong>ongoing attacks</strong> which could exploit these 0-days vulnerabilities. A patch is not available yet but Microsoft provides advice on workarounds to limit the exploitability of the vulnerabilities.</p><p><strong>Update:</strong> On the 24th of March 2020, Microsoft updated the advisory, explaining that the attack mostly affect Windows 7 and that <strong>the vulnerability is not considered as critical for recent Windows 10 systems</strong>.</p><h2 id=\"technical-details\">Technical Details</h2><p>The two 0-day vulnerabilities exist in Microsoft Windows when the Windows Adobe Type Manager Library improperly handles a specially-crafted multi-master font -- Adobe Type 1 PostScript format.</p><p>Adobe Type Manager (located in <code>%windir%\\system32\\atmfd.dll</code>), is a kernel module that is provided by Windows and provides support for OpenType fonts. This kernel module is loaded when a user opens or previews (<em>Preview Pane</em> and <em>Details Pane</em> in Windows Explorer) documents containing OpenType fonts.</p><p>The change in criticality for Windows 10 build 1709 and later [2] is due to the fact that font parsing was moved to <code>fontdrvhost.exe</code>, a sandboxed user-space process. <code>fontdrvhost.exe</code> likely shares code with <code>atmfd.dll</code>, which explains why those system are also vulnerable [3]. However, the attacker will need another vulnerability to escape the <code>AppContainer</code> sandbox. Also note that in some cases, the <code>atmfd.dll</code> may still be present on the newer system (build 1709 and later), but will not be used for font parsing.</p><p>Apart from exploiting these vulnerabilities by convincing a user to open or preview a specially crafted document, the vulnerability could also be exploited via the <code>WebClient</code> service through a remote WebDAV server.</p><h2 id=\"products-affected\">Products Affected</h2><ul><li>Windows 10 for 32-bit Systems</li><li>Windows 10 for x64-based Systems</li><li>Windows 10 Version 1607 for 32-bit Systems</li><li>Windows 10 Version 1607 for x64-based Systems</li><li>Windows 10 Version 1709 for 32-bit Systems</li><li>Windows 10 Version 1709 for ARM64-based Systems</li><li>Windows 10 Version 1709 for x64-based Systems</li><li>Windows 10 Version 1803 for 32-bit Systems</li><li>Windows 10 Version 1803 for ARM64-based Systems</li><li>Windows 10 Version 1803 for x64-based Systems</li><li>Windows 10 Version 1809 for 32-bit Systems</li><li>Windows 10 Version 1809 for ARM64-based Systems</li><li>Windows 10 Version 1809 for x64-based Systems</li><li>Windows 10 Version 1903 for 32-bit Systems</li><li>Windows 10 Version 1903 for ARM64-based Systems</li><li>Windows 10 Version 1903 for x64-based Systems</li><li>Windows 10 Version 1909 for 32-bit Systems</li><li>Windows 10 Version 1909 for ARM64-based Systems</li><li>Windows 10 Version 1909 for x64-based Systems</li><li>Windows 7 for 32-bit Systems Service Pack 1</li><li>Windows 7 for x64-based Systems Service Pack 1</li><li>Windows 8.1 for 32-bit systems</li><li>Windows 8.1 for x64-based systems</li><li>Windows RT 8.1</li><li>Windows Server 2008 for 32-bit Systems Service Pack 2</li><li>Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)</li><li>Windows Server 2008 for Itanium-Based Systems Service Pack 2</li><li>Windows Server 2008 for x64-based Systems Service Pack 2</li><li>Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)</li><li>Windows Server 2008 R2 for Itanium-Based Systems Service Pack 1</li><li>Windows Server 2008 R2 for x64-based Systems Service Pack 1</li><li>Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)</li><li>Windows Server 2012</li><li>Windows Server 2012 (Server Core installation)</li><li>Windows Server 2012 R2</li><li>Windows Server 2012 R2 (Server Core installation)</li><li>Windows Server 2016</li><li>Windows Server 2016 (Server Core installation)</li><li>Windows Server 2019</li><li>Windows Server 2019 (Server Core installation)</li><li>Windows Server, version 1803 (Server Core Installation)</li><li>Windows Server, version 1903 (Server Core installation)</li><li>Windows Server, version 1909 (Server Core installation)</li></ul><h2 id=\"recommendations\">Recommendations</h2><p>Microsoft has not yet released a patch for this vulnerability. It is recommended to apply workarounds until the patch is available.</p><h3 id=\"workarounds-recommended-by-microsoft\">Workarounds Recommended by Microsoft</h3><p>Microsoft recommends the following workarounds to limit the scope of the vulnerabilities, especially on versions before Windows 10 build 1709 [1].</p><h4 id=\"disable-the-preview-pane-and-details-pane-in-windows-explorer\">Disable the Preview Pane and Details Pane in Windows Explorer</h4><p>For Windows Server 2008, Windows 7, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, and Windows 8.1, perform the following steps:</p><ul><li>Open Windows Explorer, click <em>Organize</em>, and then click <em>Layout</em>.</li><li>Clear both the <em>Details pane</em> and <em>Preview pane</em> menu options.</li><li>Click <em>Organize</em>, and then click <em>Folder and search options</em>.</li><li>Click the <em>View</em> tab.</li><li>Under <em>Advanced settings</em>, check the <em>Always show icons, never thumbnails</em> box.</li><li>Close all open instances of Windows Explorer for the change to take effect.</li></ul><p>For Windows Server 2016, Windows 10, and Windows Server 2019, perform the following steps:</p><ul><li>Open Windows Explorer, click the <em>View</em> tab.</li><li>Clear both the <em>Details pane</em> and <em>Preview pane</em> menu options.</li><li>Click <em>Options</em>, and then click <em>Change folder and search options</em>.</li><li>Click the <em>View</em> tab.</li><li>Under <em>Advanced settings</em>, check the <em>Always show icons, never thumbnails</em> box.</li><li>Close all open instances of Windows Explorer for the change to take effect.</li></ul><h4 id=\"disable-the-webclient-service\">Disable the <code>WebClient</code> Service</h4><p>Perform the following steps:</p><ul><li>Click <em>Start</em>, click <em>Run</em> (or press the <em>Windows Key</em> and <em>R</em> on the keyboard), type <code>services.msc</code> and then click <em>OK</em>.</li><li>Right-click <code>WebClient</code> service and select <em>Properties</em>.</li><li>Change the <em>Startup type</em> to <em>Disabled</em>. If the service is running, click <em>Stop</em>.</li><li>Click <em>OK</em> and exit the management application.</li></ul><h4 id=\"rename-atmfddll-only-for-systems-prior-to-windows-10-build-1709\">Rename <code>atmfd.dll</code> (only for systems prior to Windows 10 build 1709)</h4><p>For 32-bit systems, enter the following commands at an administrative command prompt and restart the system:</p><pre><code>cd \"%windir%\\system32\"\ntakeown.exe /f atmfd.dll\nicacls.exe atmfd.dll /save atmfd.dll.acl\nicacls.exe atmfd.dll /grant Administrators:(F)\nrename atmfd.dll x-atmfd.dll\n</code></pre><p>For 64-bit systems, enter the following commands at an administrative command prompt and restart the system:</p><pre><code>cd \"%windir%\\system32\"\ntakeown.exe /f atmfd.dll\nicacls.exe atmfd.dll /save atmfd.dll.acl\nicacls.exe atmfd.dll /grant Administrators:(F)\nrename atmfd.dll x-atmfd.dll\ncd \"%windir%\\syswow64\"\ntakeown.exe /f atmfd.dll\nicacls.exe atmfd.dll /save atmfd.dll.acl\nicacls.exe atmfd.dll /grant Administrators:(F)\nrename atmfd.dll x-atmfd.dll\n</code></pre><h4 id=\"optional-procedure-for-windows-81-operating-systems-and-below-disable-atmfd\">Optional Procedure for Windows 8.1 Operating Systems and Below (Disable <code>ATMFD</code>)</h4><p>Set the following registry key:</p><pre><code>HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\DisableATMFD, DWORD = 1\n</code></pre><h3 id=\"micropatching\">Micropatching</h3><p>On 26th of March 2020, 0patch proposed a micropatch for Windows 7 64-bit and Windows Server 2008 R2 without Extended Security Updates (ESU) [4].</p><p>The patch injects in <code>gdi32.dll</code> right before the <code>syscall</code> instruction to transfer execution to the kernel in function <code>NtGdiAddFontResourceW</code>, successfully covering all common execution points that various Windows applications such as Windows Explorer, Font Viewer, and applications use to parse Adobe Type 1 PostScript fonts.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV200006\">https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV200006</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://twitter.com/DidierStevens/status/1242387445850791937\">https://twitter.com/DidierStevens/status/1242387445850791937</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://twitter.com/DidierStevens/status/1242249023303499777\">https://twitter.com/DidierStevens/status/1242249023303499777</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://blog.0patch.com/2020/03/micropatching-unknown-0days-in-windows.html\">https://blog.0patch.com/2020/03/micropatching-unknown-0days-in-windows.html</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": []
}