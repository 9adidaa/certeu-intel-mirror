{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2024-032.pdf"
  },
  "title": "Critical Vulnerability in XZ Utils",
  "serial_number": "2024-032",
  "publish_date": "02-04-2024 16:31:14",
  "description": "[Updated] On March 29, several companies issued a warning regarding a backdoor found in the XZ Utils software. XZ Utils is a data compression software and may be present in Linux distributions. The malicious code may allow a Threat Actor, with the right authentication key, to achieve gated pre-auth RCE on affected systems.<br>\nIt is recommended downgrading XZ Utils to a not compromised version.<br>\n",
  "url_title": "2024-032",
  "content_markdown": "---\ntitle: 'Critical Vulnerability in XZ Utils'\nnumber: '2024-032'\nversion: '1.1'\noriginal_date: 'March 29, 2024'\ndate: 'April 02, 2024'\n---\n\n_History:_\n\n* _30/03/2024 --- v1.0 -- Initial publication_\n* _02/04/2024 --- v1.1 -- Information update_\n\n# Summary\n\n**[Updated]** On March 29, several companies issued a warning regarding a backdoor found in the XZ Utils software. XZ Utils is a data compression software and may be present in Linux distributions. The malicious code may allow a Threat Actor, with the right authentication key, to achieve gated pre-auth RCE on affected systems. [1]\n\nIt is recommended downgrading XZ Utils to a not compromised version.\n\n# Technical details\n\n**[Updated]** The issue is tracked as **CVE-2024-3094**, with a CVSS score of 10 out of 10. The malicious code interferes with authentication in `sshd` via `systemd`. Under the right circumstances, this interference allows someone with the right private key to hijack the `sshd` process and from there to execute commands on the targeted system. [1]\n\n## Execution chain\n\n**[New]**  The execution chain also consists of multiple stages [7]:\n\n- A malicious script `build-to-host.m4` is run during the library’s build process and decodes the “test” file `bad-3-corrupt_lzma2.xz` into a bash script.\n- The bash script then performs a more complicated decode process on another “test” file, `good-large_compressed.lzma`, decoding it into another script\n- That script then extracts a shared object `liblzma_la-crc64-fast.o`, which is added to the compilation process of `liblzma`\n\nThe shared object itself is compiled into `liblzma`, and replaces the regular function name resolution process. The malicious library interferes with the function resolving process, so it could replace the function pointer for the OpenSSH function `RSA_public_decrypt`.\n\nIt then points that function to a malicious one of its own which, allegedly, extracts a command from the authenticating client’s certificate (after verifying that it is the one of the threat actor) and passes it on to the `system()` function for execution, thereby achieving RCE prior to authentication.\n\n# Affected Products\n\n**[Updated]** XZ Utils has been found compromised starting with version 5.6.0.\n\nNearly all Linux distributions are using XZ Utils. However, the compromised version was mainly distributed in testing versions of the distributions. The following Linux distributions are known to be affected by the issue:\n\n- Fedora Linux 40 beta [2];\n- Fedora Rawhide [2];\n- openSUSE Tumbleweed and openSUSE MicroOS [3];\n- Debian testing, unstable, and experimental versions [4];\n- Kali Linux [5].\n- Arch Linux [8]\n\nThe following distributions have indicated they are not affected:\n\n- Ubuntu [9]\n- Alpine Linux [10]\n- Amazon Linux [11]\n- Red Hat Enterprise Linux [12]\n- Gentoo [13]\n- Linux Mint [14]\n\n_Please note that this list is not exhaustive as the information about this issue may still be incomplete._\n\n# Recommendations\n\nIt is strongly advised to immediately stop using affected distribution, or -- if possible -- downgrade XZ Utils to a version before 5.6.0. It is currently understood that version 5.4.6 should be unaffected. It is advised to prioritise Internet-fronting assets.\n\n# References\n\n[1] <https://arstechnica.com/security/2024/04/what-we-know-about-the-xz-utils-backdoor-that-almost-infected-the-world/>\n\n[2] <https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users>\n\n[3] <https://news.opensuse.org/2024/03/29/xz-backdoor/>\n\n[4] <https://lists.debian.org/debian-security-announce/2024/msg00057.html>\n\n[5] <https://twitter.com/kalilinux/status/1773786266074513523>\n\n[6] <https://thehackernews.com/2024/03/urgent-secret-backdoor-found-in-xz.html?m=1&s=09>\n\n[7] <https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know>\n\n[8] <https://archlinux.org/news/the-xz-package-has-been-backdoored/>\n\n[9] <https://ubuntu.com/security/CVE-2024-3094>\n\n[10] <https://security.alpinelinux.org/vuln/CVE-2024-3094>\n\n[11] <https://aws.amazon.com/fr/security/security-bulletins/AWS-2024-002/>\n\n[12] <https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users>\n\n[13] <https://security.gentoo.org/glsa/202403-04>\n\n[14] <https://forums.linuxmint.com/viewtopic.php?t=416756>",
  "content_html": "<p><em>History:</em></p><ul><li><em>30/03/2024 --- v1.0 -- Initial publication</em></li><li><em>02/04/2024 --- v1.1 -- Information update</em></li></ul><h2 id=\"summary\">Summary</h2><p><strong>[Updated]</strong> On March 29, several companies issued a warning regarding a backdoor found in the XZ Utils software. XZ Utils is a data compression software and may be present in Linux distributions. The malicious code may allow a Threat Actor, with the right authentication key, to achieve gated pre-auth RCE on affected systems. [1]</p><p>It is recommended downgrading XZ Utils to a not compromised version.</p><h2 id=\"technical-details\">Technical details</h2><p><strong>[Updated]</strong> The issue is tracked as <strong>CVE-2024-3094</strong>, with a CVSS score of 10 out of 10. The malicious code interferes with authentication in <code>sshd</code> via <code>systemd</code>. Under the right circumstances, this interference allows someone with the right private key to hijack the <code>sshd</code> process and from there to execute commands on the targeted system. [1]</p><h3 id=\"execution-chain\">Execution chain</h3><p><strong>[New]</strong> The execution chain also consists of multiple stages [7]:</p><ul><li>A malicious script <code>build-to-host.m4</code> is run during the library’s build process and decodes the “test” file <code>bad-3-corrupt_lzma2.xz</code> into a bash script.</li><li>The bash script then performs a more complicated decode process on another “test” file, <code>good-large_compressed.lzma</code>, decoding it into another script</li><li>That script then extracts a shared object <code>liblzma_la-crc64-fast.o</code>, which is added to the compilation process of <code>liblzma</code></li></ul><p>The shared object itself is compiled into <code>liblzma</code>, and replaces the regular function name resolution process. The malicious library interferes with the function resolving process, so it could replace the function pointer for the OpenSSH function <code>RSA_public_decrypt</code>.</p><p>It then points that function to a malicious one of its own which, allegedly, extracts a command from the authenticating client’s certificate (after verifying that it is the one of the threat actor) and passes it on to the <code>system()</code> function for execution, thereby achieving RCE prior to authentication.</p><h2 id=\"affected-products\">Affected Products</h2><p><strong>[Updated]</strong> XZ Utils has been found compromised starting with version 5.6.0.</p><p>Nearly all Linux distributions are using XZ Utils. However, the compromised version was mainly distributed in testing versions of the distributions. The following Linux distributions are known to be affected by the issue:</p><ul><li>Fedora Linux 40 beta [2];</li><li>Fedora Rawhide [2];</li><li>openSUSE Tumbleweed and openSUSE MicroOS [3];</li><li>Debian testing, unstable, and experimental versions [4];</li><li>Kali Linux [5].</li><li>Arch Linux [8]</li></ul><p>The following distributions have indicated they are not affected:</p><ul><li>Ubuntu [9]</li><li>Alpine Linux [10]</li><li>Amazon Linux [11]</li><li>Red Hat Enterprise Linux [12]</li><li>Gentoo [13]</li><li>Linux Mint [14]</li></ul><p><em>Please note that this list is not exhaustive as the information about this issue may still be incomplete.</em></p><h2 id=\"recommendations\">Recommendations</h2><p>It is strongly advised to immediately stop using affected distribution, or -- if possible -- downgrade XZ Utils to a version before 5.6.0. It is currently understood that version 5.4.6 should be unaffected. It is advised to prioritise Internet-fronting assets.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://arstechnica.com/security/2024/04/what-we-know-about-the-xz-utils-backdoor-that-almost-infected-the-world/\">https://arstechnica.com/security/2024/04/what-we-know-about-the-xz-utils-backdoor-that-almost-infected-the-world/</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users\">https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://news.opensuse.org/2024/03/29/xz-backdoor/\">https://news.opensuse.org/2024/03/29/xz-backdoor/</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://lists.debian.org/debian-security-announce/2024/msg00057.html\">https://lists.debian.org/debian-security-announce/2024/msg00057.html</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://twitter.com/kalilinux/status/1773786266074513523\">https://twitter.com/kalilinux/status/1773786266074513523</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://thehackernews.com/2024/03/urgent-secret-backdoor-found-in-xz.html?m=1&s=09\">https://thehackernews.com/2024/03/urgent-secret-backdoor-found-in-xz.html?m=1&amp;s=09</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know\">https://www.akamai.com/blog/security-research/critical-linux-backdoor-xz-utils-discovered-what-to-know</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://archlinux.org/news/the-xz-package-has-been-backdoored/\">https://archlinux.org/news/the-xz-package-has-been-backdoored/</a></p><p>[9] <a rel=\"noopener\" target=\"_blank\" href=\"https://ubuntu.com/security/CVE-2024-3094\">https://ubuntu.com/security/CVE-2024-3094</a></p><p>[10] <a rel=\"noopener\" target=\"_blank\" href=\"https://security.alpinelinux.org/vuln/CVE-2024-3094\">https://security.alpinelinux.org/vuln/CVE-2024-3094</a></p><p>[11] <a rel=\"noopener\" target=\"_blank\" href=\"https://aws.amazon.com/fr/security/security-bulletins/AWS-2024-002/\">https://aws.amazon.com/fr/security/security-bulletins/AWS-2024-002/</a></p><p>[12] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users\">https://www.redhat.com/en/blog/urgent-security-alert-fedora-41-and-rawhide-users</a></p><p>[13] <a rel=\"noopener\" target=\"_blank\" href=\"https://security.gentoo.org/glsa/202403-04\">https://security.gentoo.org/glsa/202403-04</a></p><p>[14] <a rel=\"noopener\" target=\"_blank\" href=\"https://forums.linuxmint.com/viewtopic.php?t=416756\">https://forums.linuxmint.com/viewtopic.php?t=416756</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": [
    "CVE-2024-3094"
  ]
}