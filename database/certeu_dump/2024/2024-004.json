{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2024-004.pdf"
  },
  "title": "Critical Vulnerabilities in Ivanti Connect Secure",
  "serial_number": "2024-004",
  "publish_date": "09-02-2024 09:26:56",
  "description": "On January 10, 2024, Ivanti has released an advisory about two critical vulnerabilities in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities, identified as CVE-2023-46805 and CVE-2024-21887, have been exploited in the wild and can allow remote attackers to execute arbitrary commands on targeted gateways.<br>\nOn January 31, 2024, Ivanti has released an advisory about two new critical vulnerabilities in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities are identified as CVE-2024-21888 and CVE-2024-21893. CVE-2024-21893 have been exploited in the wild chained with CVE-2024-21887 and can lead to remote attackers to execute arbitrary commands on targeted gateways.<br>\n[New] On February 8, 2024, Ivanti has released an advisory about a new critical vulnerability in Ivanti Connect Secure (ICS) and Policy Secure gateways. The vulnerability tracked as CVE-2024-22024 is a new authentication bypass. While Ivanti claims that this vulnerability was found during their internal review and testing of their code, Watchtowr researchers claim otherwise.<br>\n",
  "url_title": "2024-004",
  "content_markdown": "---\ntitle: 'Critical Vulnerabilities in Ivanti Connect Secure'\nnumber: '2024-004'\nversion: '1.5'\noriginal_date: 'January 10, 2024'\ndate: 'February 9, 2024'\n---\n\n_History:_\n\n* _11/01/2024 --- v1.0 -- Initial publication_\n* _16/01/2024 --- v1.1 -- Adding patch schedule and information about remediation_\n* _23/01/2024 --- v1.2 -- Adding information about race condition when pushing configurations_\n* _31/01/2024 --- v1.3 -- Adding information about new vulnerabilities_\n* _07/02/2024 --- v1.4 -- Update the recommendations section_\n* _09/02/2024 --- v1.5 -- Adding information about new vulnerability_\n\n# Summary\n\nOn January 10, 2024, Ivanti has released an advisory about two critical vulnerabilities [1,2] in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities, identified as **CVE-2023-46805** and **CVE-2024-21887**, have been exploited in the wild and can allow remote attackers to execute arbitrary commands on targeted gateways.\n\nOn January 31, 2024, Ivanti has released an advisory about two new critical vulnerabilities [2] in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities are identified as **CVE-2024-21888** and **CVE-2024-21893**. **CVE-2024-21893** have been exploited in the wild chained with **CVE-2024-21887** and can lead to remote attackers to execute arbitrary commands on targeted gateways.\n\n**[New]** On February 8, 2024, Ivanti has released an advisory about a new critical vulnerability in Ivanti Connect Secure (ICS) and Policy Secure gateways. The vulnerability tracked as **CVE-2024-22024** is a new authentication bypass [6]. While Ivanti claims that this vulnerability was found during their internal review and testing of their code, Watchtowr researchers claim otherwise [7].\n\n# Technical Details\n\nThe first vulnerability, **CVE-2023-46805** with a CVSS score of 8.2, is an authentication bypass in the gateways web component. This flaw enables attackers to access restricted resources by circumventing control checks.\n\nThe second vulnerability, **CVE-2024-21887** with a CVSS score of 9.1, is a command injection vulnerability that allows authenticated administrators to execute arbitrary commands on vulnerable appliances by sending specially crafted requests.\n\nThe third vulnerability, **CVE-2024-21888** with a CVSS score of 8.8, is a privilege escalation vulnerability in the web component that can allow a user to elevate privileges to that of an administrator.\n\nThe fourth vulnerability, **CVE-2024-21893** with a CVSS score of 8.2, is a server-side request forgery vulnerability in the SAML component that can allow an attacker to access certain restricted resources without authentication.\n\n**[New]** The fifth vulnerability, **CVE-2024-22024** with a CVSS score of 8.3 , is an authentication bypass vulnerability involving an XML external entity or XXE vulnerability in the SAML component.\n\nWhen those vulnerabilities are combined, attackers can run arbitrary commands on all supported versions of the impacted products without requiring authentication.\n\n# Affected Products\n\nAll supported versions of Ivanti Connect Secure (ICS) and Policy Secure gateways.\n\nIvanti released the patch availability schedule by version [2].\n\n| Version | Product | Target Week |\n| --- | --- | --- |\n| 9.1R14x | Ivanti Connect Secure | Week of 29 January  |\n| 9.1R15x | Ivanti Connect Secure | Week of 12 February |\n| 9.1R16x | Ivanti Connect Secure | Week of 29 January |\n| 9.1R17x | Ivanti Connect Secure | Week of 22 January |\n| 9.1R18x | Ivanti Connect Secure | Week of 22 January |\n| 22.1R6x | Ivanti Connect Secure | Week of 19 February |\n| 22.2R4x | Ivanti Connect Secure | Week of 12 February  |\n| 22.3R1x | Ivanti Connect Secure | Week of 29 January  |\n| 22.4R1x | Ivanti Connect Secure | Week of 12 February |\n| 22.4R2x | Ivanti Connect Secure | Week of 22 January |\n| 22.5R1x | Ivanti Connect Secure | Week of 22 January |\n| 22.5R2x | Ivanti Connect Secure | Week of 19 February |\n| 22.6R1x | Ivanti Connect Secure | Week of 12 February  |\n| 22.6R2x | Ivanti Connect Secure | Week of January 29 |\n| 22.5R1x | ZTA | Week of 29 January |\n| 22.6R1x | ZTA | Week of 22 January |\n\n**[New]** The vulnerability affects a limited number of versions for which a patch is available already:\n\n- Ivanti Connect Secure versions 9.1R14.4, 9.1R17.2, 9.1R18.3, 22.4R2.2 and 22.5R1.1;\n- Ivanti Policy Secure version 22.5R1.1;\n- ZTA version 22.6R1.3. \n\n\n# Recommendations\n\nAll the supported products are vulnerable. Ivanti has provided early-access patches, for the various product versions as follows:\n\n| Product | Product version | Patch availability |\n| --- |:---:| --- |\n| Ivanti Connect Secure | 9.1R18.3 | [ICS_9.1_R18.3_package-24995.1.pkg](https://download.ivanti.com/downloads/support/ICS_9.1_R18.3_package-24995.1.pkg) |\n| Ivanti Connect Secure | 22.4R2.2 | [ICS_22.4R2.2_package-2149.1.pkg](https://download.ivanti.com/downloads/support/ICS_22.4R2.2_package-2149.1.pkg) |\n| Ivanti Connect Secure | 22.5R1.1 | [ICS_22.5R1.1_package-2175.1.pkg](https://download.ivanti.com/downloads/support/ICS_22.5R1.1_package-2175.1.pkg) |\n| Ivanti Connect Secure | 9.1R14.4 | Contact Ivanti Support |\n| Ivanti Connect Secure | 9.1R17.2 | Contact Ivanti Support |\n| Ivanti ZTA | 22.6R1.3 | Contact Ivanti Support |\n\nCERT-EU recommends proceeding as follows:\n\n- Immediate actions:\n    - apply mitigation;\n    - acquire forensic evidence (disk image and memory) to perform a compromise assessment;\n    - apply the remediation steps.\n- If the above cannot be implemented:\n    - take the affected Ivanti products offline until you can;\n\nWhen it is not possible or too late to perform the compromise assessment, it is recommended applying the \"assume compromise\" scenario [5]. It is then advised to:\n- reset local users' password (including the one of the service accounts used for auth server configuration);\n- revoke and replace any private certificate that was installed on the ICS;\n- hunt for suspicious events during the past weeks (suspicious authentication, recently created privileged users, etc.)\n\n**[New]** As for the vulnerability **CVE-2024-22024**: \n\n- If the process desbribed above (i.e., see immediate actions) has been performed, CERT-EU recommends applying the patches available as soon as possible [6].\n- If the process desbribed above (i.e., see immediate actions) has not been performed, CERT-EU recommends applying the update as par of the remediation actions.\n\n## Mitigation\n\n**[Updated]** The zero-days can be mitigated by importing the `importing mitigation.release.20240126.5.xml` file available to customers via Ivanti's download portal [2]. As the vulnerabilities affect critical functionality of the affected Ivanti systems, applying the mitigation file (rather than patching) can have serious adverse effects on their operation. This mitigation successfully blocks the vulnerability **CVE-2024-22024**.\n\nAs per Ivanti, customers should stop pushing configurations to appliances having the mitigation in place until the appliance is patched [2]. If configurations are pushed while the mitigation is in place, it will stop the mitigation from functioning and leave the appliances vulnerable.\n\nAs per Ivanti, the provided mitigation blocks the exploitation of vulnerabilities and prevents further use of the webshell.\n\n## Compromise assessment\n\nIvanti advises customers to run the external Integrity Checker Tool (ICT) [3]. However, the ICT will scan a snapshot of the current state of the appliance and cannot necessarily detect threat actor activity if they have returned the appliance to an apparent clean state.\n\nTo assess with certainty if a device has (or had) been compromised, a forensic image of the device should be performed by contacting Ivanti support. As the external ICT will reboot the system, it is advised to take forensic evidence before running it.\n\n## Remediation\n\nIt is recommended factory resetting and upgrading, or upgrading twice the affected Ivanti systems. Ivanti shared the recovery steps related to those vulnerabilities [4].\n\n**[Updated]** Note: Ivanti does not recommend resetting the appliances for customers who applied the patch released on January 31 or 1 February and completed a factory reset [6].\n\n# References\n\n[1] <https://www.bleepingcomputer.com/news/security/ivanti-warns-of-connect-secure-zero-days-exploited-in-attacks/>\n\n[2] <https://forums.ivanti.com/s/article/KB-CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways>\n\n[3] <https://forums.ivanti.com/s/article/KB44755?language=en_US>\n\n[4] <https://forums.ivanti.com/s/article/Recovery-Steps-Related-to-CVE-2023-46805-and-CVE-2024-21887?language=en_US>\n\n[5] <https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure>\n\n[6] <https://forums.ivanti.com/s/article/CVE-2024-22024-XXE-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure?language=en_US>\n\n[7] <https://labs.watchtowr.com/are-we-now-part-of-ivanti/>",
  "content_html": "<p><em>History:</em></p><ul><li><em>11/01/2024 --- v1.0 -- Initial publication</em></li><li><em>16/01/2024 --- v1.1 -- Adding patch schedule and information about remediation</em></li><li><em>23/01/2024 --- v1.2 -- Adding information about race condition when pushing configurations</em></li><li><em>31/01/2024 --- v1.3 -- Adding information about new vulnerabilities</em></li><li><em>07/02/2024 --- v1.4 -- Update the recommendations section</em></li><li><em>09/02/2024 --- v1.5 -- Adding information about new vulnerability</em></li></ul><h2 id=\"summary\">Summary</h2><p>On January 10, 2024, Ivanti has released an advisory about two critical vulnerabilities [1,2] in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities, identified as <strong>CVE-2023-46805</strong> and <strong>CVE-2024-21887</strong>, have been exploited in the wild and can allow remote attackers to execute arbitrary commands on targeted gateways.</p><p>On January 31, 2024, Ivanti has released an advisory about two new critical vulnerabilities [2] in Ivanti Connect Secure (ICS) and Policy Secure gateways. These vulnerabilities are identified as <strong>CVE-2024-21888</strong> and <strong>CVE-2024-21893</strong>. <strong>CVE-2024-21893</strong> have been exploited in the wild chained with <strong>CVE-2024-21887</strong> and can lead to remote attackers to execute arbitrary commands on targeted gateways.</p><p><strong>[New]</strong> On February 8, 2024, Ivanti has released an advisory about a new critical vulnerability in Ivanti Connect Secure (ICS) and Policy Secure gateways. The vulnerability tracked as <strong>CVE-2024-22024</strong> is a new authentication bypass [6]. While Ivanti claims that this vulnerability was found during their internal review and testing of their code, Watchtowr researchers claim otherwise [7].</p><h2 id=\"technical-details\">Technical Details</h2><p>The first vulnerability, <strong>CVE-2023-46805</strong> with a CVSS score of 8.2, is an authentication bypass in the gateways web component. This flaw enables attackers to access restricted resources by circumventing control checks.</p><p>The second vulnerability, <strong>CVE-2024-21887</strong> with a CVSS score of 9.1, is a command injection vulnerability that allows authenticated administrators to execute arbitrary commands on vulnerable appliances by sending specially crafted requests.</p><p>The third vulnerability, <strong>CVE-2024-21888</strong> with a CVSS score of 8.8, is a privilege escalation vulnerability in the web component that can allow a user to elevate privileges to that of an administrator.</p><p>The fourth vulnerability, <strong>CVE-2024-21893</strong> with a CVSS score of 8.2, is a server-side request forgery vulnerability in the SAML component that can allow an attacker to access certain restricted resources without authentication.</p><p><strong>[New]</strong> The fifth vulnerability, <strong>CVE-2024-22024</strong> with a CVSS score of 8.3 , is an authentication bypass vulnerability involving an XML external entity or XXE vulnerability in the SAML component.</p><p>When those vulnerabilities are combined, attackers can run arbitrary commands on all supported versions of the impacted products without requiring authentication.</p><h2 id=\"affected-products\">Affected Products</h2><p>All supported versions of Ivanti Connect Secure (ICS) and Policy Secure gateways.</p><p>Ivanti released the patch availability schedule by version [2].</p><table><thead><tr><th>Version</th><th>Product</th><th>Target Week</th></tr></thead><tbody><tr><td>9.1R14x</td><td>Ivanti Connect Secure</td><td>Week of 29 January</td></tr><tr><td>9.1R15x</td><td>Ivanti Connect Secure</td><td>Week of 12 February</td></tr><tr><td>9.1R16x</td><td>Ivanti Connect Secure</td><td>Week of 29 January</td></tr><tr><td>9.1R17x</td><td>Ivanti Connect Secure</td><td>Week of 22 January</td></tr><tr><td>9.1R18x</td><td>Ivanti Connect Secure</td><td>Week of 22 January</td></tr><tr><td>22.1R6x</td><td>Ivanti Connect Secure</td><td>Week of 19 February</td></tr><tr><td>22.2R4x</td><td>Ivanti Connect Secure</td><td>Week of 12 February</td></tr><tr><td>22.3R1x</td><td>Ivanti Connect Secure</td><td>Week of 29 January</td></tr><tr><td>22.4R1x</td><td>Ivanti Connect Secure</td><td>Week of 12 February</td></tr><tr><td>22.4R2x</td><td>Ivanti Connect Secure</td><td>Week of 22 January</td></tr><tr><td>22.5R1x</td><td>Ivanti Connect Secure</td><td>Week of 22 January</td></tr><tr><td>22.5R2x</td><td>Ivanti Connect Secure</td><td>Week of 19 February</td></tr><tr><td>22.6R1x</td><td>Ivanti Connect Secure</td><td>Week of 12 February</td></tr><tr><td>22.6R2x</td><td>Ivanti Connect Secure</td><td>Week of January 29</td></tr><tr><td>22.5R1x</td><td>ZTA</td><td>Week of 29 January</td></tr><tr><td>22.6R1x</td><td>ZTA</td><td>Week of 22 January</td></tr></tbody></table><p><strong>[New]</strong> The vulnerability affects a limited number of versions for which a patch is available already:</p><ul><li>Ivanti Connect Secure versions 9.1R14.4, 9.1R17.2, 9.1R18.3, 22.4R2.2 and 22.5R1.1;</li><li>Ivanti Policy Secure version 22.5R1.1;</li><li>ZTA version 22.6R1.3. </li></ul><h2 id=\"recommendations\">Recommendations</h2><p>All the supported products are vulnerable. Ivanti has provided early-access patches, for the various product versions as follows:</p><table><thead><tr><th>Product</th><th style=\"text-align:center;\">Product version</th><th>Patch availability</th></tr></thead><tbody><tr><td>Ivanti Connect Secure</td><td style=\"text-align:center;\">9.1R18.3</td><td><a rel=\"noopener\" target=\"_blank\" href=\"https://download.ivanti.com/downloads/support/ICS_9.1_R18.3_package-24995.1.pkg\">ICS<em>9.1</em>R18.3_package-24995.1.pkg</a></td></tr><tr><td>Ivanti Connect Secure</td><td style=\"text-align:center;\">22.4R2.2</td><td><a rel=\"noopener\" target=\"_blank\" href=\"https://download.ivanti.com/downloads/support/ICS_22.4R2.2_package-2149.1.pkg\">ICS<em>22.4R2.2</em>package-2149.1.pkg</a></td></tr><tr><td>Ivanti Connect Secure</td><td style=\"text-align:center;\">22.5R1.1</td><td><a rel=\"noopener\" target=\"_blank\" href=\"https://download.ivanti.com/downloads/support/ICS_22.5R1.1_package-2175.1.pkg\">ICS<em>22.5R1.1</em>package-2175.1.pkg</a></td></tr><tr><td>Ivanti Connect Secure</td><td style=\"text-align:center;\">9.1R14.4</td><td>Contact Ivanti Support</td></tr><tr><td>Ivanti Connect Secure</td><td style=\"text-align:center;\">9.1R17.2</td><td>Contact Ivanti Support</td></tr><tr><td>Ivanti ZTA</td><td style=\"text-align:center;\">22.6R1.3</td><td>Contact Ivanti Support</td></tr></tbody></table><p>CERT-EU recommends proceeding as follows:</p><ul><li>Immediate actions: <ul><li>apply mitigation;</li><li>acquire forensic evidence (disk image and memory) to perform a compromise assessment;</li><li>apply the remediation steps.</li></ul></li><li>If the above cannot be implemented: <ul><li>take the affected Ivanti products offline until you can;</li></ul></li></ul><p>When it is not possible or too late to perform the compromise assessment, it is recommended applying the \"assume compromise\" scenario [5]. It is then advised to: - reset local users' password (including the one of the service accounts used for auth server configuration); - revoke and replace any private certificate that was installed on the ICS; - hunt for suspicious events during the past weeks (suspicious authentication, recently created privileged users, etc.)</p><p><strong>[New]</strong> As for the vulnerability <strong>CVE-2024-22024</strong>: </p><ul><li>If the process desbribed above (i.e., see immediate actions) has been performed, CERT-EU recommends applying the patches available as soon as possible [6].</li><li>If the process desbribed above (i.e., see immediate actions) has not been performed, CERT-EU recommends applying the update as par of the remediation actions.</li></ul><h3 id=\"mitigation\">Mitigation</h3><p><strong>[Updated]</strong> The zero-days can be mitigated by importing the <code>importing mitigation.release.20240126.5.xml</code> file available to customers via Ivanti's download portal [2]. As the vulnerabilities affect critical functionality of the affected Ivanti systems, applying the mitigation file (rather than patching) can have serious adverse effects on their operation. This mitigation successfully blocks the vulnerability <strong>CVE-2024-22024</strong>.</p><p>As per Ivanti, customers should stop pushing configurations to appliances having the mitigation in place until the appliance is patched [2]. If configurations are pushed while the mitigation is in place, it will stop the mitigation from functioning and leave the appliances vulnerable.</p><p>As per Ivanti, the provided mitigation blocks the exploitation of vulnerabilities and prevents further use of the webshell.</p><h3 id=\"compromise-assessment\">Compromise assessment</h3><p>Ivanti advises customers to run the external Integrity Checker Tool (ICT) [3]. However, the ICT will scan a snapshot of the current state of the appliance and cannot necessarily detect threat actor activity if they have returned the appliance to an apparent clean state.</p><p>To assess with certainty if a device has (or had) been compromised, a forensic image of the device should be performed by contacting Ivanti support. As the external ICT will reboot the system, it is advised to take forensic evidence before running it.</p><h3 id=\"remediation\">Remediation</h3><p>It is recommended factory resetting and upgrading, or upgrading twice the affected Ivanti systems. Ivanti shared the recovery steps related to those vulnerabilities [4].</p><p><strong>[Updated]</strong> Note: Ivanti does not recommend resetting the appliances for customers who applied the patch released on January 31 or 1 February and completed a factory reset [6].</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/ivanti-warns-of-connect-secure-zero-days-exploited-in-attacks/\">https://www.bleepingcomputer.com/news/security/ivanti-warns-of-connect-secure-zero-days-exploited-in-attacks/</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://forums.ivanti.com/s/article/KB-CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways\">https://forums.ivanti.com/s/article/KB-CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://forums.ivanti.com/s/article/KB44755?language=en_US\">https://forums.ivanti.com/s/article/KB44755?language=en_US</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://forums.ivanti.com/s/article/Recovery-Steps-Related-to-CVE-2023-46805-and-CVE-2024-21887?language=en_US\">https://forums.ivanti.com/s/article/Recovery-Steps-Related-to-CVE-2023-46805-and-CVE-2024-21887?language=en_US</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure\">https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://forums.ivanti.com/s/article/CVE-2024-22024-XXE-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure?language=en_US\">https://forums.ivanti.com/s/article/CVE-2024-22024-XXE-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure?language=en_US</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://labs.watchtowr.com/are-we-now-part-of-ivanti/\">https://labs.watchtowr.com/are-we-now-part-of-ivanti/</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": [
    "CVE-2023-46805",
    "CVE-2024-21887",
    "CVE-2024-21888",
    "CVE-2024-21893",
    "CVE-2024-22024"
  ]
}