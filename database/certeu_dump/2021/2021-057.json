{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2021-057.pdf"
  },
  "title": "NPM library UA-Parser-JS hijacked",
  "serial_number": "2021-057",
  "publish_date": "26-10-2021 08:37:00",
  "description": "On October 22, CISA published an alert about malware discovered in the popular NPM library, \"ua-parser-js\". The hackers hijacked the library to infect Linux and Windows devices with cryptominers and password-stealing trojans in a supply-chain attack. This library is used to parse a browser's user agent to identify a visitor's browser, engine, OS, CPU, and Device type/model. Moreover, it has a lot of dependent libraries. The attackers hijacked the account of the developer on October 22, and published three malicious versions of the library, the \"0.7.29\", \"0.8.0\", and \"1.0.0\".",
  "url_title": "2021-057",
  "content_markdown": "---\ntitle: 'NPM library UA-Parser-JS hijacked'\nversion: '1.0'\nnumber: '2021-057'\ndate: 'October 26, 2021'\n---\n\n_History:_\n\n* _26/10/2021 --- v1.0 -- Initial publication_\n\n# Summary\n\nOn October 22, CISA published an alert about malware discovered in the popular NPM library, `ua-parser-js` [1]. The hackers hijacked the library to infect Linux and Windows devices with cryptominers and password-stealing trojans in a supply-chain attack. This library is used to parse a browser's user agent to identify a visitor's browser, engine, OS, CPU, and Device type/model [2]. Moreover, it has a lot of dependent libraries [3]. The attackers hijacked the account of the developer on October 22, and published three malicious versions of the library, the `0.7.29`, `0.8.0`, and `1.0.0` [4]. \n\n# Technical Details\n\nOnce the compromised library is installed on the device, a script named `preinstall.js` will identify the operating system, and will either launch a Linux shell script or a Windows batch file.  For devices based on Linux operating system, the aforementioned script will check the location of the device. If the device is not located in Russia, Ukraine, Belarus, and Kazakhstan, it will download the `jsextension` [5] program from  `159.148.186[.]228` and run it on the device. The `jsextension` is an XMRig Monero miner [2].\n\nFor devices based on Windows operating system, the batch file will download the same XMRig Monero cryptominer, save it as `jsextension.exe` [6], and run it. It will also download a `sdd.dll` file [7] from `citationsherbe[.]at` and save it as `create.dll`. This DLL is a password-stealing trojan that will try to steal the passwords stored on the device, targeting for example FTP clients, VNC, messaging software, email clients, and browsers. To be executed, `create.dll` should be loaded using the command line `regsvr32.exe -s create.dll`. Moreover, this DLL will run a PowerShell script to steal passwords for the Windows Credential Manager [2].\n\n## List of IOCs\n\n- `preinstall.js`\n- `jsextension` - SHA256: `ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e`\n- `jsextension.exe` - SHA256: `7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5`\n- `sdd.dll` - SHA256: `2a3acdcd76575762b18c18c644a745125f55ce121f742d2aad962521bc7f25fd`\n- `159.148.186[.]228`\n- `citationsherbe[.]at`\n\n# Affected Products\n\n- UA-Parser-JS version 0.7.29\n- UA-Parser-JS version 0.8.0\n- UA-Parser-JS version 1.0.0\n\n# Recommendations\n\nCERT-EU recommends downloading and applying the patched version of `UA-Parser-JS`, respectively `0.7.30`, `0.8.1`, `1.0.1`. \n\nCERT-EU also recommends searching for the IOCs on potentially affected devices and firewalls. If one of the files is detected, it should be deleted immediately, the passwords/keys should be changed, and the tokens rotated.\n\n# References\n\n[1] <https://us-cert.cisa.gov/ncas/current-activity/2021/10/22/malware-discovered-popular-npm-package-ua-parser-js>\n\n[2] <https://www.bleepingcomputer.com/news/security/popular-npm-library-hijacked-to-install-password-stealers-miners/>\n\n[3] <https://www.npmjs.com/package/ua-parser-js>\n\n[4] <https://github.com/faisalman/ua-parser-js/issues/536#issuecomment-949742904>\n\n[5] <https://www.virustotal.com/gui/file/ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e/detection>\n\n[6] <https://www.virustotal.com/gui/file/7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5>\n\n[7] <https://www.virustotal.com/gui/file/2a3acdcd76575762b18c18c644a745125f55ce121f742d2aad962521bc7f25fd>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>26/10/2021 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On October 22, CISA published an alert about malware discovered in the popular NPM library, <code>ua-parser-js</code> [1]. The hackers hijacked the library to infect Linux and Windows devices with cryptominers and password-stealing trojans in a supply-chain attack. This library is used to parse a browser's user agent to identify a visitor's browser, engine, OS, CPU, and Device type/model [2]. Moreover, it has a lot of dependent libraries [3]. The attackers hijacked the account of the developer on October 22, and published three malicious versions of the library, the <code>0.7.29</code>, <code>0.8.0</code>, and <code>1.0.0</code> [4]. </p><h2 id=\"technical-details\">Technical Details</h2><p>Once the compromised library is installed on the device, a script named <code>preinstall.js</code> will identify the operating system, and will either launch a Linux shell script or a Windows batch file. For devices based on Linux operating system, the aforementioned script will check the location of the device. If the device is not located in Russia, Ukraine, Belarus, and Kazakhstan, it will download the <code>jsextension</code> [5] program from <code>159.148.186[.]228</code> and run it on the device. The <code>jsextension</code> is an XMRig Monero miner [2].</p><p>For devices based on Windows operating system, the batch file will download the same XMRig Monero cryptominer, save it as <code>jsextension.exe</code> [6], and run it. It will also download a <code>sdd.dll</code> file [7] from <code>citationsherbe[.]at</code> and save it as <code>create.dll</code>. This DLL is a password-stealing trojan that will try to steal the passwords stored on the device, targeting for example FTP clients, VNC, messaging software, email clients, and browsers. To be executed, <code>create.dll</code> should be loaded using the command line <code>regsvr32.exe -s create.dll</code>. Moreover, this DLL will run a PowerShell script to steal passwords for the Windows Credential Manager [2].</p><h3 id=\"list-of-iocs\">List of IOCs</h3><ul><li><code>preinstall.js</code></li><li><code>jsextension</code> - SHA256: <code>ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e</code></li><li><code>jsextension.exe</code> - SHA256: <code>7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5</code></li><li><code>sdd.dll</code> - SHA256: <code>2a3acdcd76575762b18c18c644a745125f55ce121f742d2aad962521bc7f25fd</code></li><li><code>159.148.186[.]228</code></li><li><code>citationsherbe[.]at</code></li></ul><h2 id=\"affected-products\">Affected Products</h2><ul><li>UA-Parser-JS version 0.7.29</li><li>UA-Parser-JS version 0.8.0</li><li>UA-Parser-JS version 1.0.0</li></ul><h2 id=\"recommendations\">Recommendations</h2><p>CERT-EU recommends downloading and applying the patched version of <code>UA-Parser-JS</code>, respectively <code>0.7.30</code>, <code>0.8.1</code>, <code>1.0.1</code>. </p><p>CERT-EU also recommends searching for the IOCs on potentially affected devices and firewalls. If one of the files is detected, it should be deleted immediately, the passwords/keys should be changed, and the tokens rotated.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://us-cert.cisa.gov/ncas/current-activity/2021/10/22/malware-discovered-popular-npm-package-ua-parser-js\">https://us-cert.cisa.gov/ncas/current-activity/2021/10/22/malware-discovered-popular-npm-package-ua-parser-js</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/popular-npm-library-hijacked-to-install-password-stealers-miners/\">https://www.bleepingcomputer.com/news/security/popular-npm-library-hijacked-to-install-password-stealers-miners/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.npmjs.com/package/ua-parser-js\">https://www.npmjs.com/package/ua-parser-js</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/faisalman/ua-parser-js/issues/536#issuecomment-949742904\">https://github.com/faisalman/ua-parser-js/issues/536#issuecomment-949742904</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.virustotal.com/gui/file/ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e/detection\">https://www.virustotal.com/gui/file/ea131cc5ccf6aa6544d6cb29cdb78130feed061d2097c6903215be1499464c2e/detection</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.virustotal.com/gui/file/7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5\">https://www.virustotal.com/gui/file/7f986cd3c946f274cdec73f80b84855a77bc2a3c765d68897fbc42835629a5d5</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.virustotal.com/gui/file/2a3acdcd76575762b18c18c644a745125f55ce121f742d2aad962521bc7f25fd\">https://www.virustotal.com/gui/file/2a3acdcd76575762b18c18c644a745125f55ce121f742d2aad962521bc7f25fd</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": []
}