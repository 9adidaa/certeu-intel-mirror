{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2021-062.pdf"
  },
  "title": "NPM Libraries Hijacked",
  "serial_number": "2021-062",
  "publish_date": "05-11-2021 13:12:00",
  "description": "On November 4, malicious code was discovered in two popular NPM libraries after unexpected releases have been published for the \"coa\" library. Hours after these new releases, the \"rc\" library was also found hijacked. The first library is a parser for command-line options, while the second is used as a configuration loader for applications. Malicious releases were all published on November 4, versions \"2.0.3\", \"2.0.4\", \"2.1.1\", \"2.1.3\", \"3.1.3\" for the \"coa\" library, and versions \"1.2.9\", \"1.3.9\", \"2.3.9\" for the \"rc\" library.",
  "url_title": "2021-062",
  "content_markdown": "---\ntitle: 'NPM Libraries Hijacked'\nversion: '1.0'\nnumber: '2021-062'\ndate: 'November 5, 2021'\n---\n\n_History:_\n\n* _05/11/2021 --- v1.0 -- Initial publication_\n\n# Summary\n\nOn November 4, malicious code was discovered in two popular NPM libraries [1] after unexpected releases have been published for the `coa` library. Hours after these new releases, the `rc` library was also found hijacked. The first library is a parser for command-line options, while the second is used as a configuration loader for applications. Malicious releases were all published on November 4, versions `2.0.3`, `2.0.4`, `2.1.1`, `2.1.3`, `3.1.3` for the `coa` library, and versions `1.2.9`, `1.3.9`, `2.3.9` for the `rc` library.\n\n# Technical Details\n\nBoth hijacked libraries target Windows Operating Systems. During the installation, a suspicious preinstall script will try to execute `compile.js` (which does not exist in the original versions of these packages). This file contains obfuscated JavaScript code attempts to launch `compile.bat`, also included in the NPM archive, which would eventually download and execute a `sdd.dll` from `pastorcryptograph[.]at` [1].\n\nOnce loaded using `regsvr32.exe -s compile.dll`, the DLL will perform various activities such as stealing passwords from various web browsers and applications (VNC clients, FTP clients, email accounts, etc.), taking screenshots, and keystroke logging.\n\n_Note: These techniques and files share similarities with the hijacked versions of the `ua-parser-js` library (see SA2021-057 [2])._\n\n## List of IOCs\n\n- `compile.js`\n- `compile.bat`\n- `sdd.dll` from `coa` - SHA256: `f53ef1ed12f9ba49831ea33100083c9a92bc8adc6620f8a3b36a2d9ae2eb8591`\n- `sdd.dll` from `rc` - SAH256: `26451f7f6fe297adf6738295b1dcc70f7678434ef21d8b6aad5ec00beb8a72cf`\n- `pastorcryptograph[.]at`\n\n# Affected Products\n\n- `coa` library versions `2.0.3`, `2.0.4`, `2.1.1`, `2.1.3`, `3.1.3`\n- `rc` library versions `1.2.9`, `1.3.9`, `2.3.9`\n\n_Note: Not all versions contain the malicious files. Nevertheless, it is advised to consider all these versions as malicious._\n\n# Recommendations\n\nCERT-EU recommends reverting to safe versions of the `coa` and `rc` libraries (if not automatically done):\n\n - version `2.0.2` for `coa` library [3]\n - version `1.2.8` for `rc` library [4]\n\nCERT-EU also recommends searching for the IOCs on potentially affected devices. Any computer that has these packages installed or running should be considered compromised. All malicious files should be removed, and passwords and other secrets should be rotated as soon as possible.\n\n# References\n\n[1] <https://www.bleepingcomputer.com/news/security/popular-coa-npm-library-hijacked-to-steal-user-passwords/>\n\n[2] <https://media.cert.europa.eu/static/SecurityAdvisories/2021/CERT-EU-SA2021-057.pdf>\n\n[3] <https://github.com/advisories/GHSA-73qr-pfmq-6rp8>\n\n[4] <https://github.com/advisories/GHSA-g2q5-5433-rhrf>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>05/11/2021 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On November 4, malicious code was discovered in two popular NPM libraries [1] after unexpected releases have been published for the <code>coa</code> library. Hours after these new releases, the <code>rc</code> library was also found hijacked. The first library is a parser for command-line options, while the second is used as a configuration loader for applications. Malicious releases were all published on November 4, versions <code>2.0.3</code>, <code>2.0.4</code>, <code>2.1.1</code>, <code>2.1.3</code>, <code>3.1.3</code> for the <code>coa</code> library, and versions <code>1.2.9</code>, <code>1.3.9</code>, <code>2.3.9</code> for the <code>rc</code> library.</p><h2 id=\"technical-details\">Technical Details</h2><p>Both hijacked libraries target Windows Operating Systems. During the installation, a suspicious preinstall script will try to execute <code>compile.js</code> (which does not exist in the original versions of these packages). This file contains obfuscated JavaScript code attempts to launch <code>compile.bat</code>, also included in the NPM archive, which would eventually download and execute a <code>sdd.dll</code> from <code>pastorcryptograph[.]at</code> [1].</p><p>Once loaded using <code>regsvr32.exe -s compile.dll</code>, the DLL will perform various activities such as stealing passwords from various web browsers and applications (VNC clients, FTP clients, email accounts, etc.), taking screenshots, and keystroke logging.</p><p><em>Note: These techniques and files share similarities with the hijacked versions of the <code>ua-parser-js</code> library (see SA2021-057 [2]).</em></p><h3 id=\"list-of-iocs\">List of IOCs</h3><ul><li><code>compile.js</code></li><li><code>compile.bat</code></li><li><code>sdd.dll</code> from <code>coa</code> - SHA256: <code>f53ef1ed12f9ba49831ea33100083c9a92bc8adc6620f8a3b36a2d9ae2eb8591</code></li><li><code>sdd.dll</code> from <code>rc</code> - SAH256: <code>26451f7f6fe297adf6738295b1dcc70f7678434ef21d8b6aad5ec00beb8a72cf</code></li><li><code>pastorcryptograph[.]at</code></li></ul><h2 id=\"affected-products\">Affected Products</h2><ul><li><code>coa</code> library versions <code>2.0.3</code>, <code>2.0.4</code>, <code>2.1.1</code>, <code>2.1.3</code>, <code>3.1.3</code></li><li><code>rc</code> library versions <code>1.2.9</code>, <code>1.3.9</code>, <code>2.3.9</code></li></ul><p><em>Note: Not all versions contain the malicious files. Nevertheless, it is advised to consider all these versions as malicious.</em></p><h2 id=\"recommendations\">Recommendations</h2><p>CERT-EU recommends reverting to safe versions of the <code>coa</code> and <code>rc</code> libraries (if not automatically done):</p><ul><li>version <code>2.0.2</code> for <code>coa</code> library [3]</li><li>version <code>1.2.8</code> for <code>rc</code> library [4]</li></ul><p>CERT-EU also recommends searching for the IOCs on potentially affected devices. Any computer that has these packages installed or running should be considered compromised. All malicious files should be removed, and passwords and other secrets should be rotated as soon as possible.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/popular-coa-npm-library-hijacked-to-steal-user-passwords/\">https://www.bleepingcomputer.com/news/security/popular-coa-npm-library-hijacked-to-steal-user-passwords/</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://media.cert.europa.eu/static/SecurityAdvisories/2021/CERT-EU-SA2021-057.pdf\">https://media.cert.europa.eu/static/SecurityAdvisories/2021/CERT-EU-SA2021-057.pdf</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/advisories/GHSA-73qr-pfmq-6rp8\">https://github.com/advisories/GHSA-73qr-pfmq-6rp8</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/advisories/GHSA-g2q5-5433-rhrf\">https://github.com/advisories/GHSA-g2q5-5433-rhrf</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  },
  "cves": []
}