{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2018-019.pdf"
  },
  "title": "New attack on WPA/WPA2 using PMKID",
  "serial_number": "2018-019",
  "publish_date": "08-08-2018 06:53:00",
  "description": "On August 4th the researcher Jens Steube published on his website a new method to get a hash which involves the Pre-Shared Key (PSK) of a wifi access point. A successful exploitation of the technique allows an attacker to retrieve the PSK.",
  "url_title": "2018-019",
  "content_markdown": "---\ntitle: 'New attack on WPA/WPA2 using PMKID'\nversion: '1.0'\nnumber: '2018-019'\ndate: 'Aug 07, 2018'\n---\n\n_History:_\n\n* _07/08/2018 --- v1.0: Initial publication_\n\n# Summary\n\nOn August 4th the researcher Jens Steube published on his website a new method to get a hash which involves the Pre-Share Key (PSK) for a wifi access point [1]. A successfull exploitation of the technique allows an attacker to retrieve the PSK.\n\n# Technical details\n\nThe PSK could be recovered from this hash by brute force cracking. Although this technique has no advantage for the PSK cracking process - which depends essentially on the password length and complexity - it allows to have a hash, which can be attacked, much faster than other techniques, speeding up the overall process.\n\nOther methods requires that the attacker sniff the network in order to record an authentication handshake. On the other hand, the new method just requires a single frame from the authentication handshake that can be generated as part of an authentication tried started by the attacker. From this authentication frame - which is a regular part of the protocol - the attacker can retrieve the PMKID, which is an optional hash value potentially present in all the wifi networks which support roaming between the access points (AP). The issue is, that it is well-known the way this hash is computed by using HMAC-SHA1, where the key is the  Pairwise Master Key (PMK) and the data part is the concatenation of a fixed string label \"PMK Name\", the access point's MAC address and the station's MAC address.\n\n`PMKID = HMAC-SHA1-128(PMK, \"PMK Name\" | MAC_AP | MAC_STA)`\n\nBesides just note, that in a pre-shared-key network, the PMK is actually the PSK. However,when wifi networks use the authentication protocol 802.1X - which means the use of an authentication server - instead of Pre-Shared keys, the PMK is a shared secret key between the AP and the client derived from the authentication process [2].\n\nAccording the original post [1] these are the advantages of this new method in comparison with the former relying the full handshake recording:\n\n * No more regular users required - because the attacker directly communicates with the AP (aka \"client-less\" attack)\n * No more waiting for a complete 4-way handshake between the regular user and the AP\n * No more eventual retransmissions of EAPOL frames (which can lead to uncrackable results)\n * No more lost EAPOL frames when the regular user or the AP is too far away from the attacker\n * No more fixing of nonce and replaycounter values required (resulting in slightly higher speeds)\n * No more special output format (pcap, hccapx, etc.) - final data will appear as regular hex encoded string\n\n# Products Affected\n\nAs far as this attack harness an standard part of the protocol, it seems it should work in all wifi routers using the protocols 802.11i/p/q/r with roaming enabled. Of course, networks using authentication servers in the context of the 802.1X protocol are not affected. Finally, WPA3 is not affected.\n\n# Recommendations\n\nAs far as this new method provides a hash that has to be cracked by brute force, strengthen the password by generating long enough random passwords including special characters is a good security measure (twenty characters can be more than enough).\n\n## Workarounds\n\nTurning off the roaming option can be helpful, but that should be tested in each specific implementation since optional fields of the protocol are involved. On the other hand, just strengthen the password can be an easier solution.\n\n# References\n\n[1] <https://hashcat.net/forum/thread-7717.html>\n\n[2] <https://en.wikipedia.org/wiki/IEEE_802.11i-2004#The_four-way_handshake>\n\n[3] <https://www.bleepingcomputer.com/news/security/new-method-simplifies-cracking-wpa-wpa2-passwords-on-80211-networks/>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>07/08/2018 --- v1.0: Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On August 4th the researcher Jens Steube published on his website a new method to get a hash which involves the Pre-Share Key (PSK) for a wifi access point [1]. A successfull exploitation of the technique allows an attacker to retrieve the PSK.</p><h2 id=\"technical-details\">Technical details</h2><p>The PSK could be recovered from this hash by brute force cracking. Although this technique has no advantage for the PSK cracking process - which depends essentially on the password length and complexity - it allows to have a hash, which can be attacked, much faster than other techniques, speeding up the overall process.</p><p>Other methods requires that the attacker sniff the network in order to record an authentication handshake. On the other hand, the new method just requires a single frame from the authentication handshake that can be generated as part of an authentication tried started by the attacker. From this authentication frame - which is a regular part of the protocol - the attacker can retrieve the PMKID, which is an optional hash value potentially present in all the wifi networks which support roaming between the access points (AP). The issue is, that it is well-known the way this hash is computed by using HMAC-SHA1, where the key is the Pairwise Master Key (PMK) and the data part is the concatenation of a fixed string label \"PMK Name\", the access point's MAC address and the station's MAC address.</p><p><code>PMKID = HMAC-SHA1-128(PMK, \"PMK Name\" | MAC_AP | MAC_STA)</code></p><p>Besides just note, that in a pre-shared-key network, the PMK is actually the PSK. However,when wifi networks use the authentication protocol 802.1X - which means the use of an authentication server - instead of Pre-Shared keys, the PMK is a shared secret key between the AP and the client derived from the authentication process [2].</p><p>According the original post [1] these are the advantages of this new method in comparison with the former relying the full handshake recording:</p><ul><li>No more regular users required - because the attacker directly communicates with the AP (aka \"client-less\" attack)</li><li>No more waiting for a complete 4-way handshake between the regular user and the AP</li><li>No more eventual retransmissions of EAPOL frames (which can lead to uncrackable results)</li><li>No more lost EAPOL frames when the regular user or the AP is too far away from the attacker</li><li>No more fixing of nonce and replaycounter values required (resulting in slightly higher speeds)</li><li>No more special output format (pcap, hccapx, etc.) - final data will appear as regular hex encoded string</li></ul><h2 id=\"products-affected\">Products Affected</h2><p>As far as this attack harness an standard part of the protocol, it seems it should work in all wifi routers using the protocols 802.11i/p/q/r with roaming enabled. Of course, networks using authentication servers in the context of the 802.1X protocol are not affected. Finally, WPA3 is not affected.</p><h2 id=\"recommendations\">Recommendations</h2><p>As far as this new method provides a hash that has to be cracked by brute force, strengthen the password by generating long enough random passwords including special characters is a good security measure (twenty characters can be more than enough).</p><h3 id=\"workarounds\">Workarounds</h3><p>Turning off the roaming option can be helpful, but that should be tested in each specific implementation since optional fields of the protocol are involved. On the other hand, just strengthen the password can be an easier solution.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://hashcat.net/forum/thread-7717.html\">https://hashcat.net/forum/thread-7717.html</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://en.wikipedia.org/wiki/IEEE_802.11i-2004#The_four-way_handshake\">https://en.wikipedia.org/wiki/IEEE_802.11i-2004#The_four-way_handshake</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/new-method-simplifies-cracking-wpa-wpa2-passwords-on-80211-networks/\">https://www.bleepingcomputer.com/news/security/new-method-simplifies-cracking-wpa-wpa2-passwords-on-80211-networks/</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}