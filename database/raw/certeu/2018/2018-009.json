{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2018-009.pdf"
  },
  "title": "UPDATE Cisco Smart Install Protocol Remote Code Execution Vulnerability",
  "serial_number": "2018-009",
  "publish_date": "06-04-2018 15:10:00",
  "description": "On 28th of March 2018, Cisco published a security advisory concerning a buffer overflow discovered in Smart Install feature of Cisco IOS and Cisco IOS XE software. This vulnerability allows an unauthenticated, remote attacker to execute arbitrary code on an affected device.<br>A proof of concept for the vulnerability has been published. Also, there are already many attacks observed in the wild.",
  "url_title": "2018-009",
  "content_markdown": "---\ntitle: 'Cisco Smart Install Protocol Remote Code Execution Vulnerability'\nversion: '1.1'\nnumber: '2018-009'\ndate: 'April 10, 2018'\n---\n\n_History:_\n\n* _06/04/2018 --- v1.0 -- Initial publication_\n* _10/04/2018 --- v1.1 -- Additional information added_\n\n\n# Summary\n\nOn 28th of March 2018, Cisco published a security advisory concerning a buffer overflow discovered in Smart Install feature of Cisco IOS and Cisco IOS XE software. This vulnerability allows an unauthenticated, remote attacker to execute arbitrary code on an affected device [1].\n\nSuccessful exploitation may lead to:\n\n* triggering a reload of the device,\n* executing arbitrary code on the device,\n* causing an indefinite loop on the affected device that triggers a watchdog crash.\n\nThis vulnerability has been assigned the number CVE-2018-0171.\n\nAccording to the researchers which originally reported the vulnerability, this is a **critical vulnerability** [2]:\n\n\tAV:N/AC:L/Au:N/C:C/I:C/A:C (10.0).\n\nA proof of concept for the vulnerability has been published [2]. As of the time of this writing, there are about 168 000 vulnerable devices accessible on the Internet according to Shodan. Also, there are already many attacks observed in the wild.\n\nA patch for this vulnerability was released as part of the March 28, 2018, _Cisco IOS and IOS XE Software Security Advisory Bundled Publication_, which includes 20 Cisco security advisories that describe 22 vulnerabilities [1].\n\nCisco devices that are configured as a _Smart Install Director_ are not affected by these attacks.\n\n# Products Affected\n\nAccording to Cisco Advisory [1], this vulnerability affects Cisco devices that are running a vulnerable release of Cisco IOS or IOS XE software and have the Smart Install Client feature enabled.\n\nOnly Smart Install Client switches are affected by the vulnerability that is described in this advisory. Cisco devices that are configured as a Smart Install Director are not affected (see the details about the components of the Smart Install Network below).\n\nSmart Install Client functionality is enabled by default on Cisco IOS switches on software releases that have not been updated to address Cisco bug ID `CSCvd36820`.\n\nCisco has published a list of devices supporting Smart Install [3].\n\n# Technical Details\n\nAccording the original research, which won the G-Influence award at GeekPWN 2017 Hong-Kong after its successful exploitation had been demonstrated [2], the Smart Install Client starts a server on the TCP(4786) port (open by default) to interact with the Smart Install Director.\n\nWhen the server is processing a specially crafted malicious message, a stack-based buffer overflow occurs because the size of the data copied to a fixed-size buffer is not checked. The size and data are taken directly from the network packet and could be controlled by an attacker.\n\nSome details on the techniques and methods used to create the exploit for this vulnerability can be found in the research _How To Cook Cisco_ from the original reporter [5].\n\n## Main Components of the Smart Install Network\n\nThe _Director_ builds a topology database for the network by collecting information from the network Smart Install switches.\n\nThe Director uses the database:\n\n* to assign a configuration file and image to a client,\n* as a reference to obtain the PID, the image name, and the configuration file for an on-demand update of network switches.\n\nSmart Install network uses DHCP server to assign IP addresses for transfer of specific parameters. It also relies on a TFTP server to store image and configuration files. The TFTP server can be an external device, or the Director can act as a TFTP server. Client switches have a direct or indirect connection to the Director so that they can receive image and configuration downloads from it.\n\nMore information about the Smart Install technology can be found in the official documentation [4].\n\n# Recommendations\n\nFollow these general steps in order to fix this vulnerability:\n\n* determine whether the Smart Install Client feature is enabled,\n* determine the Cisco IOS or the Cisco IOS XE software version,\n* fix the vulnerability thorough the upgrading procedures or support contact.\n\nThe detailed instructions for each of the above points are available in the original Cisco Security Advisory [1].\n\n## Workarounds\n\nIf -- for any reason -- it was not possible to apply the proper patch made available by Cisco, these are some possible mitigating actions to consider:\n\n**Disabling the Smart Install Client Functionality**\n\nAs previously mentioned, this feature might be active or not by default, depending on the software version and the patches applied. It is important to follow the official documentation for the specific software release to accomplish this task. In addition, some sources claim that this configuration could be reset after reboot, depending on the software version and the patches applied [7, 8].\n\n**Limiting Access**\n\nIf this functionality is required and the patch cannot be applied, it might be useful to introduce access-lists in the router to limit the IPs allowed to access this facility. Some examples can be found in [8], but it is always better to refer the official guide for the specific software release.\n\nIt also advisable to block this service on the perimeter firewall, and possibly consider using a VPN if this service is required to be available from outside of the organization.\n\n# References\n\n[1] <https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2>\n\n[2] <https://embedi.com/blog/cisco-smart-install-remote-code-execution/>\n\n[3] <https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html>\n\n[4] <https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html>\n\n[5] <https://embedi.com/blog/how-cook-cisco/>\n\n[6] <https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/commands.html>\n\n[7] <https://www.kaspersky.com/blog/cisco-apocalypse/21966/>\n\n[8] <https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>06/04/2018 --- v1.0 -- Initial publication</em></li><li><em>10/04/2018 --- v1.1 -- Additional information added</em></li></ul><h2 id=\"summary\">Summary</h2><p>On 28th of March 2018, Cisco published a security advisory concerning a buffer overflow discovered in Smart Install feature of Cisco IOS and Cisco IOS XE software. This vulnerability allows an unauthenticated, remote attacker to execute arbitrary code on an affected device [1].</p><p>Successful exploitation may lead to:</p><ul><li>triggering a reload of the device,</li><li>executing arbitrary code on the device,</li><li>causing an indefinite loop on the affected device that triggers a watchdog crash.</li></ul><p>This vulnerability has been assigned the number CVE-2018-0171.</p><p>According to the researchers which originally reported the vulnerability, this is a <strong>critical vulnerability</strong> [2]:</p><pre><code>AV:N/AC:L/Au:N/C:C/I:C/A:C (10.0).\n</code></pre><p>A proof of concept for the vulnerability has been published [2]. As of the time of this writing, there are about 168 000 vulnerable devices accessible on the Internet according to Shodan. Also, there are already many attacks observed in the wild.</p><p>A patch for this vulnerability was released as part of the March 28, 2018, <em>Cisco IOS and IOS XE Software Security Advisory Bundled Publication</em>, which includes 20 Cisco security advisories that describe 22 vulnerabilities [1].</p><p>Cisco devices that are configured as a <em>Smart Install Director</em> are not affected by these attacks.</p><h2 id=\"products-affected\">Products Affected</h2><p>According to Cisco Advisory [1], this vulnerability affects Cisco devices that are running a vulnerable release of Cisco IOS or IOS XE software and have the Smart Install Client feature enabled.</p><p>Only Smart Install Client switches are affected by the vulnerability that is described in this advisory. Cisco devices that are configured as a Smart Install Director are not affected (see the details about the components of the Smart Install Network below).</p><p>Smart Install Client functionality is enabled by default on Cisco IOS switches on software releases that have not been updated to address Cisco bug ID <code>CSCvd36820</code>.</p><p>Cisco has published a list of devices supporting Smart Install [3].</p><h2 id=\"technical-details\">Technical Details</h2><p>According the original research, which won the G-Influence award at GeekPWN 2017 Hong-Kong after its successful exploitation had been demonstrated [2], the Smart Install Client starts a server on the TCP(4786) port (open by default) to interact with the Smart Install Director.</p><p>When the server is processing a specially crafted malicious message, a stack-based buffer overflow occurs because the size of the data copied to a fixed-size buffer is not checked. The size and data are taken directly from the network packet and could be controlled by an attacker.</p><p>Some details on the techniques and methods used to create the exploit for this vulnerability can be found in the research <em>How To Cook Cisco</em> from the original reporter [5].</p><h3 id=\"main-components-of-the-smart-install-network\">Main Components of the Smart Install Network</h3><p>The <em>Director</em> builds a topology database for the network by collecting information from the network Smart Install switches.</p><p>The Director uses the database:</p><ul><li>to assign a configuration file and image to a client,</li><li>as a reference to obtain the PID, the image name, and the configuration file for an on-demand update of network switches.</li></ul><p>Smart Install network uses DHCP server to assign IP addresses for transfer of specific parameters. It also relies on a TFTP server to store image and configuration files. The TFTP server can be an external device, or the Director can act as a TFTP server. Client switches have a direct or indirect connection to the Director so that they can receive image and configuration downloads from it.</p><p>More information about the Smart Install technology can be found in the official documentation [4].</p><h2 id=\"recommendations\">Recommendations</h2><p>Follow these general steps in order to fix this vulnerability:</p><ul><li>determine whether the Smart Install Client feature is enabled,</li><li>determine the Cisco IOS or the Cisco IOS XE software version,</li><li>fix the vulnerability thorough the upgrading procedures or support contact.</li></ul><p>The detailed instructions for each of the above points are available in the original Cisco Security Advisory [1].</p><h3 id=\"workarounds\">Workarounds</h3><p>If -- for any reason -- it was not possible to apply the proper patch made available by Cisco, these are some possible mitigating actions to consider:</p><p><strong>Disabling the Smart Install Client Functionality</strong></p><p>As previously mentioned, this feature might be active or not by default, depending on the software version and the patches applied. It is important to follow the official documentation for the specific software release to accomplish this task. In addition, some sources claim that this configuration could be reset after reboot, depending on the software version and the patches applied [7, 8].</p><p><strong>Limiting Access</strong></p><p>If this functionality is required and the patch cannot be applied, it might be useful to introduce access-lists in the router to limit the IPs allowed to access this facility. Some examples can be found in [8], but it is always better to refer the official guide for the specific software release.</p><p>It also advisable to block this service on the perimeter firewall, and possibly consider using a VPN if this service is required to be available from outside of the organization.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2\">https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://embedi.com/blog/cisco-smart-install-remote-code-execution/\">https://embedi.com/blog/cisco-smart-install-remote-code-execution/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html\">https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html\">https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://embedi.com/blog/how-cook-cisco/\">https://embedi.com/blog/how-cook-cisco/</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/commands.html\">https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/commands.html</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.kaspersky.com/blog/cisco-apocalypse/21966/\">https://www.kaspersky.com/blog/cisco-apocalypse/21966/</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi\">https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20170214-smi</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}