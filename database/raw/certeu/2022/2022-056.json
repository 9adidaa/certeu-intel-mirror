{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2022-056.pdf"
  },
  "title": "Critical Vulnerabilities In Samba",
  "serial_number": "2022-056",
  "publish_date": "01-08-2022 15:01:00",
  "description": "On June 27, 2022, The Samba Team has released security updates to address several vulnerabilities in their product. Exploitation of these vulnerabilities may allow an attacker to cause a DoS condition, data leakage, or even to take control of all the domain.",
  "url_title": "2022-056",
  "content_markdown": "---\ntitle: 'Critical Vulnerabilities In Samba'\nversion: '1.0'\nnumber: '2022-056'\noriginal_date: 'July 27, 2022'\ndate: 'July 29, 2022'\n---\n_History:_\n\n* _29/07/2022 --- v1.0 -- Initial publication_\n\n# Summary\n\nOn June 27, 2022, The Samba Team has released security updates to address several vulnerabilities in their product. Exploitation of these vulnerabilities may allow an attacker to cause a DoS condition, data leakage, or even to take control of all the domain. [1][2]\n\n# Technical Details\n\nThe security release addresses the following defects:\n\n- **CVE-2022-2031** - Samba AD users can bypass certain restrictions associated with changing passwords.\n\n    The KDC and the kpasswd service share a single account and set of keys, allowing them to decrypt each other's tickets. This also makes the two services susceptible to confusion. A user who has been requested to change their password can exploit this to obtain and use tickets to other services. [3]\n\n- **CVE-2022-32744** - Samba AD users can forge password change requests for any user.\n\n    The KDC accepts kpasswd requests encrypted with any key known to it. By encrypting forged kpasswd requests with its own key, a user can change the passwords of other users, enabling full domain take over. [4]\n\n- **CVE-2022-32745** - Samba AD users can crash the server process with an LDAP add or modify request.\n\n    Samba AD users can cause the server to access uninitialised data with an LDAP add or modify request due to incorrect values used as the limit for a loop and as the 'count' parameter to memcpy(), usually resulting in a segmentation fault. [5]\n\n- **CVE-2022-32746** - Samba AD users can induce a use-after-free in the server process with an LDAP add or modify request.\n\n    The AD DC database audit logging module can be made to access LDAP message values that have been freed by a preceding database module, resulting in a use-after- free. This is only possible when modifying certain privileged attributes, such as userAccountControl. When the database audit logging module subsequently logs the details of the original message, it will access this freed data, generally resulting in corrupted log output or a crash. [6]\n\n- **CVE-2022-32742** - Server memory information leak via SMB1.\n\n    Please note that only versions of Samba prior to 4.11.0 are vulnerable to this bug by default. Samba versions 4.11.0 and above disable SMB1 by default, and will only be vulnerable if the administrator has deliberately enabled SMB1 in the smb.conf file. All versions of Samba with SMB1 enabled are vulnerable to a server memory information leak bug over SMB1 if a client can write data to a share. Some SMB1 write requests were not correctly range checked to ensure the client had sent enough data to fulfil the write, allowing server memory contents to be written into the file (or printer) instead of client supplied data. The client cannot control the area of the server memory that is written to the file (or printer). [7]\n\n# Recommendations \n\nCERT-EU strongly recommend upgrading samba to the last available version. Also, CERT-EU strongly discourages the use of SMB1.\n\n# References\n\n[1] <https://www.samba.org/samba/history/samba-4.16.4.html>\n\n[2] <https://nakedsecurity.sophos.com/2022/07/27/critical-samba-bug-could-let-anyone-become-domain-admin-patch-now/>\n\n[3] <https://www.samba.org/samba/security/CVE-2022-2031.html>\n\n[4] <https://www.samba.org/samba/security/CVE-2022-32744.html>\n\n[5] <https://www.samba.org/samba/security/CVE-2022-32745.html>\n\n[6] <https://www.samba.org/samba/security/CVE-2022-32746.html>\n\n[7] <https://www.samba.org/samba/security/CVE-2022-32742.html>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>29/07/2022 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On June 27, 2022, The Samba Team has released security updates to address several vulnerabilities in their product. Exploitation of these vulnerabilities may allow an attacker to cause a DoS condition, data leakage, or even to take control of all the domain. [1][2]</p><h2 id=\"technical-details\">Technical Details</h2><p>The security release addresses the following defects:</p><ul><li><p><strong>CVE-2022-2031</strong> - Samba AD users can bypass certain restrictions associated with changing passwords.</p><p>The KDC and the kpasswd service share a single account and set of keys, allowing them to decrypt each other's tickets. This also makes the two services susceptible to confusion. A user who has been requested to change their password can exploit this to obtain and use tickets to other services. [3]</p></li><li><p><strong>CVE-2022-32744</strong> - Samba AD users can forge password change requests for any user.</p><p>The KDC accepts kpasswd requests encrypted with any key known to it. By encrypting forged kpasswd requests with its own key, a user can change the passwords of other users, enabling full domain take over. [4]</p></li><li><p><strong>CVE-2022-32745</strong> - Samba AD users can crash the server process with an LDAP add or modify request.</p><p>Samba AD users can cause the server to access uninitialised data with an LDAP add or modify request due to incorrect values used as the limit for a loop and as the 'count' parameter to memcpy(), usually resulting in a segmentation fault. [5]</p></li><li><p><strong>CVE-2022-32746</strong> - Samba AD users can induce a use-after-free in the server process with an LDAP add or modify request.</p><p>The AD DC database audit logging module can be made to access LDAP message values that have been freed by a preceding database module, resulting in a use-after- free. This is only possible when modifying certain privileged attributes, such as userAccountControl. When the database audit logging module subsequently logs the details of the original message, it will access this freed data, generally resulting in corrupted log output or a crash. [6]</p></li><li><p><strong>CVE-2022-32742</strong> - Server memory information leak via SMB1.</p><p>Please note that only versions of Samba prior to 4.11.0 are vulnerable to this bug by default. Samba versions 4.11.0 and above disable SMB1 by default, and will only be vulnerable if the administrator has deliberately enabled SMB1 in the smb.conf file. All versions of Samba with SMB1 enabled are vulnerable to a server memory information leak bug over SMB1 if a client can write data to a share. Some SMB1 write requests were not correctly range checked to ensure the client had sent enough data to fulfil the write, allowing server memory contents to be written into the file (or printer) instead of client supplied data. The client cannot control the area of the server memory that is written to the file (or printer). [7]</p></li></ul><h2 id=\"recommendations\">Recommendations</h2><p>CERT-EU strongly recommend upgrading samba to the last available version. Also, CERT-EU strongly discourages the use of SMB1.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/history/samba-4.16.4.html\">https://www.samba.org/samba/history/samba-4.16.4.html</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://nakedsecurity.sophos.com/2022/07/27/critical-samba-bug-could-let-anyone-become-domain-admin-patch-now/\">https://nakedsecurity.sophos.com/2022/07/27/critical-samba-bug-could-let-anyone-become-domain-admin-patch-now/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/security/CVE-2022-2031.html\">https://www.samba.org/samba/security/CVE-2022-2031.html</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/security/CVE-2022-32744.html\">https://www.samba.org/samba/security/CVE-2022-32744.html</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/security/CVE-2022-32745.html\">https://www.samba.org/samba/security/CVE-2022-32745.html</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/security/CVE-2022-32746.html\">https://www.samba.org/samba/security/CVE-2022-32746.html</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.samba.org/samba/security/CVE-2022-32742.html\">https://www.samba.org/samba/security/CVE-2022-32742.html</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}