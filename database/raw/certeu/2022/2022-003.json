{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2022-003.pdf"
  },
  "title": "UPDATE: New Critical Vulnerabilities in Microsoft Products",
  "serial_number": "2022-003",
  "publish_date": "14-01-2022 16:26:00",
  "description": "On the 11th of January 2022, Microsoft released a software update to mitigate several vulnerabilities that affect many of its products. Few of them could lead to remote code execution on certain versions of Microsoft Windows and Server, Microsoft Exchange Servers, and Microsoft Office, Word, Excel and Sharepoint.<br>No active exploitation of these vulnerabilities is known yet, however, regarding the \"CVE-2022-21907\" vulnerability, Microsoft said that organisations should prioritise fixing it, because this vulnerability can become wormable - that is - after infection, the virus can spread laterally on the intranet. Also, a proof-of-concept code is already available publicaly.<br>This is why it is generally recommended to apply the patches as soon as possible, but please refer to [Recommendations] section for additional notes.",
  "url_title": "2022-003",
  "content_markdown": "---\ntitle: 'New Critical Vulnerabilities in Microsoft Products'\nversion: '1.2'\nnumber: '2022-003'\ndate: 'January 19, 2022'\n---\n\n_History:_\n\n* _14/01/2022 --- v1.0 -- Initial publication_\n* _17/01/2022 --- v1.1 -- Update about potential issues_\n* _19/01/2022 --- v1.2 -- Update about OOB patches_\n\n# Summary\n\nOn the 11th of January 2022, Microsoft released a software update to mitigate several vulnerabilities that affect many of its products. Few of them could lead to remote code execution on certain versions of Microsoft Windows and Server [1], Microsoft Exchange Servers, [2, 3, 4] and Microsoft Office, Word, Excel and Sharepoint [5, 6, 7, 8].\n\nNo active exploitation of these vulnerabilities is known yet, however, regarding the `CVE-2022-21907` vulnerability, Microsoft said that organisations should prioritise fixing it, because this vulnerability can become wormable -- that is -- after infection, the virus can spread laterally on the intranet. Also, a proof-of-concept code is already available publicaly [10].\n\nThis is why it is generally recommended to **apply the patches as soon as possible**, but please refer to [Recommendations] section for additional notes.\n\n# Technical Details\n\nThe critical vulnerabilities include:\n\n* CVE-2022-21907\n* CVE-2022-21846\n* CVE-2022-21855\n* CVE-2022-21969\n* CVE-2022-21840\n* CVE-2022-21841\n* CVE-2022-21842\n* CVE-2022-21837\n\nAn attacker could use these vulnerabilities to gain access and maintain persistence on the target host.\n\nIn particular, the `CVE-2022-21907` vulnerability is related to the HTTP stack (`http.sys`) used in listening mode to handle HTTP requests on Internet Information Services (IIS) servers. The vulnerability targets the HTTP trailer support feature, which allows a sender to include additional fields in a message to supply metadata, by providing a specially crafted message that can lead to remote code execution. In other words, an attacker would use a specially crafted packet to send to the target server, and the vulnerability would be triggered when the protocol stack processes the data [9].\n\nThere is not much detail available at the moment about how the other vulnerabilities could be exploited.\n\n# Affected Products\n\n* Microsoft Server 2022\n* Microsoft Windows Server 2019 (unaffected by default)\n* Microsoft Windows 11\n* Microsoft Windows 10 (version 1809, unaffected by default)\n* Microsoft Exchange Server 2013\n* Microsoft Exchange Server 2016\n* Microsoft Exchange Server 2019\n* Microsoft Office 2013\n* Microsoft Office 2016\n* Microsoft Office 2019\n* Microsoft Word 2013\n* Microsoft Excel 2013\n* Microsoft Excel 2016\n* Microsoft Sharepoint 2013\n* Microsoft Sharepoint 2016\n* Microsoft Sharepoint 2019\n\n# Recommendations\n\nAfter Microsoft released the first patches, **several issues have been reported regarding the patches for `CVE-2022-21907` vulnerability**. Patching seems to be going without problems for Windows Server 2016 and Windows Server 2012. However, for Windows Server 2012 R2, Windows Server 2019, Windows Server 2022 and Windows 10/11, there are some issues that have been reported:\n\n- The Hyper-V service no longer starts so it is no longer possible to launch the virtual machines.\n- Domain controllers restart in loop.\n- Issues with VPN connectivity on Windows client\n\nBased on these issues, five patches have been identified as troublesome:\n\n- Windows Server 2012 R2: KB5009624\n- Windows Server 2019: KB5009557\n- Windows Server 2022: KB5009555\n- Windows 10: KB5009543\n- Windows 11: KB5009566\n\nIn order to fix these issues, Microsoft released a second set of patches called: **emergency out-of-band (OOB) updates**:\n\n>_This update addresses issues related to VPN connectivity, Windows Server Domain Controllers restarting, Virtual Machines start failures, and ReFS-formatted removable media failing to mount._\n\nAll OOB updates released are available for download on the Microsoft Update Catalog, and some of them can also be installed directly through Windows Update as optional updates. If you want to install the emergency fixes through Windows Update, you will have to manually check for updates because they are optional updates and will not install automatically.\n\nIf you cannot immediately install today's out-of-band updates, you can still remove the KB5009624, KB5009557, KB5009555, KB5009566, and KB5009543 updates causing these issues. For that, admins can do a rollback or can issue one of the following commands:\n\n- Windows Server 2012 R2: `wusa /uninstall /kb:KB5009624`\n- Windows Server 2019: `wusa /uninstall /kb:KB5009557`\n- Windows Server 2022: `wusa /uninstall /kb:KB5009555`\n- Windows 10: `wusa /uninstall /kb:5009543`\n- Windows 11: `wusa /uninstall /kb:5009566`\n\n**Exception:** On Microsoft Windows Server 2019 and Windows 10 (version 1809), a mitigation is possible for the `CVE-2022-21907` without applying patches:\n\n- Delete the `DWORD` registry value `EnableTrailerSupport` if present under:\n\n```\nHKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\HTTP\\Parameters\n```\n\nThis mitigation only applies to Windows Server 2019 and Windows 10, version 1809 and does not apply to the Windows 20H2 and newer.\n\nRegarding the other vulnerabilities, no issues has been reported so they can safely be applied.\n\n# References\n\n[1] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21907>\n\n[2] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21846>\n\n[3] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21969>\n\n[4] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21855>\n\n[5] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21840>\n\n[6]\t<https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21841>\n\n[7] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21842>\n\n[8] <https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21837>\n\n[9] <https://securityonline.info/cve-2022-21907-http-protocol-stack-remote-code-execution-vulnerability/>\n\n[10] <https://github.com/antx-code/CVE-2022-21907>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>14/01/2022 --- v1.0 -- Initial publication</em></li><li><em>17/01/2022 --- v1.1 -- Update about potential issues</em></li><li><em>19/01/2022 --- v1.2 -- Update about OOB patches</em></li></ul><h2 id=\"summary\">Summary</h2><p>On the 11th of January 2022, Microsoft released a software update to mitigate several vulnerabilities that affect many of its products. Few of them could lead to remote code execution on certain versions of Microsoft Windows and Server [1], Microsoft Exchange Servers, [2, 3, 4] and Microsoft Office, Word, Excel and Sharepoint [5, 6, 7, 8].</p><p>No active exploitation of these vulnerabilities is known yet, however, regarding the <code>CVE-2022-21907</code> vulnerability, Microsoft said that organisations should prioritise fixing it, because this vulnerability can become wormable -- that is -- after infection, the virus can spread laterally on the intranet. Also, a proof-of-concept code is already available publicaly [10].</p><p>This is why it is generally recommended to <strong>apply the patches as soon as possible</strong>, but please refer to [Recommendations] section for additional notes.</p><h2 id=\"technical-details\">Technical Details</h2><p>The critical vulnerabilities include:</p><ul><li>CVE-2022-21907</li><li>CVE-2022-21846</li><li>CVE-2022-21855</li><li>CVE-2022-21969</li><li>CVE-2022-21840</li><li>CVE-2022-21841</li><li>CVE-2022-21842</li><li>CVE-2022-21837</li></ul><p>An attacker could use these vulnerabilities to gain access and maintain persistence on the target host.</p><p>In particular, the <code>CVE-2022-21907</code> vulnerability is related to the HTTP stack (<code>http.sys</code>) used in listening mode to handle HTTP requests on Internet Information Services (IIS) servers. The vulnerability targets the HTTP trailer support feature, which allows a sender to include additional fields in a message to supply metadata, by providing a specially crafted message that can lead to remote code execution. In other words, an attacker would use a specially crafted packet to send to the target server, and the vulnerability would be triggered when the protocol stack processes the data [9].</p><p>There is not much detail available at the moment about how the other vulnerabilities could be exploited.</p><h2 id=\"affected-products\">Affected Products</h2><ul><li>Microsoft Server 2022</li><li>Microsoft Windows Server 2019 (unaffected by default)</li><li>Microsoft Windows 11</li><li>Microsoft Windows 10 (version 1809, unaffected by default)</li><li>Microsoft Exchange Server 2013</li><li>Microsoft Exchange Server 2016</li><li>Microsoft Exchange Server 2019</li><li>Microsoft Office 2013</li><li>Microsoft Office 2016</li><li>Microsoft Office 2019</li><li>Microsoft Word 2013</li><li>Microsoft Excel 2013</li><li>Microsoft Excel 2016</li><li>Microsoft Sharepoint 2013</li><li>Microsoft Sharepoint 2016</li><li>Microsoft Sharepoint 2019</li></ul><h2 id=\"recommendations\">Recommendations</h2><p>After Microsoft released the first patches, <strong>several issues have been reported regarding the patches for <code>CVE-2022-21907</code> vulnerability</strong>. Patching seems to be going without problems for Windows Server 2016 and Windows Server 2012. However, for Windows Server 2012 R2, Windows Server 2019, Windows Server 2022 and Windows 10/11, there are some issues that have been reported:</p><ul><li>The Hyper-V service no longer starts so it is no longer possible to launch the virtual machines.</li><li>Domain controllers restart in loop.</li><li>Issues with VPN connectivity on Windows client</li></ul><p>Based on these issues, five patches have been identified as troublesome:</p><ul><li>Windows Server 2012 R2: KB5009624</li><li>Windows Server 2019: KB5009557</li><li>Windows Server 2022: KB5009555</li><li>Windows 10: KB5009543</li><li>Windows 11: KB5009566</li></ul><p>In order to fix these issues, Microsoft released a second set of patches called: <strong>emergency out-of-band (OOB) updates</strong>:</p><blockquote><p><em>This update addresses issues related to VPN connectivity, Windows Server Domain Controllers restarting, Virtual Machines start failures, and ReFS-formatted removable media failing to mount.</em></p></blockquote><p>All OOB updates released are available for download on the Microsoft Update Catalog, and some of them can also be installed directly through Windows Update as optional updates. If you want to install the emergency fixes through Windows Update, you will have to manually check for updates because they are optional updates and will not install automatically.</p><p>If you cannot immediately install today's out-of-band updates, you can still remove the KB5009624, KB5009557, KB5009555, KB5009566, and KB5009543 updates causing these issues. For that, admins can do a rollback or can issue one of the following commands:</p><ul><li>Windows Server 2012 R2: <code>wusa /uninstall /kb:KB5009624</code></li><li>Windows Server 2019: <code>wusa /uninstall /kb:KB5009557</code></li><li>Windows Server 2022: <code>wusa /uninstall /kb:KB5009555</code></li><li>Windows 10: <code>wusa /uninstall /kb:5009543</code></li><li>Windows 11: <code>wusa /uninstall /kb:5009566</code></li></ul><p><strong>Exception:</strong> On Microsoft Windows Server 2019 and Windows 10 (version 1809), a mitigation is possible for the <code>CVE-2022-21907</code> without applying patches:</p><ul><li>Delete the <code>DWORD</code> registry value <code>EnableTrailerSupport</code> if present under:</li></ul><pre><code>HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Services\\HTTP\\Parameters\n</code></pre><p>This mitigation only applies to Windows Server 2019 and Windows 10, version 1809 and does not apply to the Windows 20H2 and newer.</p><p>Regarding the other vulnerabilities, no issues has been reported so they can safely be applied.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21907\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21907</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21846\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21846</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21969\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21969</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21855\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21855</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21840\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21840</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21841\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21841</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21842\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21842</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21837\">https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21837</a></p><p>[9] <a rel=\"noopener\" target=\"_blank\" href=\"https://securityonline.info/cve-2022-21907-http-protocol-stack-remote-code-execution-vulnerability/\">https://securityonline.info/cve-2022-21907-http-protocol-stack-remote-code-execution-vulnerability/</a></p><p>[10] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/antx-code/CVE-2022-21907\">https://github.com/antx-code/CVE-2022-21907</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}