{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2022-023.pdf"
  },
  "title": "UPDATE: Critical RCE Vulnerability in Spring Core",
  "serial_number": "2022-023",
  "publish_date": "31-03-2022 12:48:00",
  "description": "On 29/03/2022, some cybersecurity analysts were alarmed following the publication of a few posts from a Chinese Twitter account. These tweets contained screenshots showing a 0-day exploit in Spring Core, a popular Java library.<br>The vulnerability has been assigned \"CVE-2022-22965\", and it is being referred to as \"Spring4Shell\". The key points known at this time are:<br>- This vulnerability allows an unauthenticated attacker to execute arbitrary code on the targeted system.<br>- Proofs-of-Concept (PoCs) of this vulnerability are publicly available.<br>- Patches have been released.<br>CERT-EU recommends to patch as soon as possible.<br>Additionally, another Spring vulnerability was also part of the recent discussions on the internet - assigned CVE number \"CVE-2022-22963\" (CVSS score 9.0), it is a remote code execution vulnerability in Spring Cloud Function, which is a separate Java library from Spring Core. Public POCs are available. CERT-EU recommend to also patch this vulnerability as soon as possible.",
  "url_title": "2022-023",
  "content_markdown": "---\ntitle: 'Critical RCE Vulnerability in Spring Core'\nversion: '1.2'\nnumber: '2022-023'\ndate: 'April 5, 2022'\n---\n\n_History:_\n\n* _31/03/2022 --- v1.0 -- Initial publication_\n* _31/03/2022 --- v1.1 -- Update with info about the patch_ \n* _05/04/2022 --- v1.2 -- Update with VMware Security patch_\n\n# Summary\n\nOn 29/03/2022, some cybersecurity analysts were alarmed following the publication of a few posts from a Chinese Twitter account. These tweets contained screenshots showing a 0-day exploit in Spring Core, a popular Java library. \n\nThe vulnerability has been assigned `CVE-2022-22965` [6, 7], and it is being referred to as `Spring4Shell` [2, 4]. The key points known at this time are:\n\n- This vulnerability allows an unauthenticated attacker to execute arbitrary code on the targeted system.\n- Proofs-of-Concept (PoCs) of this vulnerability are **publicly** available. \n- **Patches have been released.**\n\nCERT-EU recommends to patch as soon as possible. \n\nAdditionally, another Spring vulnerability was also part of the recent discussions on the internet - assigned CVE number `CVE-2022-22963` (CVSS score 9.0) [1], it is a remote code execution vulnerability in Spring Cloud Function, which is a separate Java library from Spring Core. Public POCs are available [1]. CERT-EU recommend to also patch this vulnerability as soon as possible.\n\n# Technical Details \n\n**Spring4Shell (`CVE-2022-22965`)**\n\nThe vulnerability impacts Spring MVC and Spring WebFlux applications running on JDK 9+. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it [6].\n\nThe exploitation of this vulnerability requires an endpoint with _DataBinder_ enabled (e.g., a POST request that decodes data from the request body automatically) and depends heavily on the servlet container for the application. _For example, when Spring is deployed to Apache Tomcat, the `WebAppClassLoader` is accessible, which allows an attacker to call getters and setters to ultimately write a malicious JSP file to disk. However, if Spring is deployed using the Embedded Tomcat Servlet Container the classloader is a `LaunchedURLClassLoader` which has limited access_ [2].\n\n# Affected Products\n\nSpecific requirements seem to be needed to be directly affected by `CVE-2022-22965` (Spring4Shell):\n\n- JDK 9 or higher\n- Apache Tomcat as the Servlet container\n- Packaged as WAR\n- `spring-webmvc` or `spring-webflux` dependency\n- Spring Framework versions 5.3.0 to 5.3.17, 5.2.0 to 5.2.19, and older versions\n\nAdditionnaly, VMware has published security updates about its cloud computing and virtualization products that are impacted by this vulnerability [3]:\n\n- VMware Tanzu Application Service for VMs – versions 2.10 to 2.13\n- VMware Tanzu Operations Manager – versions 2.8 to 2.10\n- VMware Tanzu Kubernetes Grid Integrated Edition (TKGI) – versions 1.11 to 1.13 \n\nRegarding the `CVE-2022-22963` :\n\n-  Spring Cloud Function\n\t-\t3.1.6\n\t-\t3.2.2\n\t-\tOlder, unsupported versions are also affected.\n\n# Recommendations and Workarounds\n\nSpring Framework versions 5.3.18 and 5.2.20, which address the `CVE-2022-22963` vulnerability, are now available on Maven Central. Spring Boot 2.5.12 with Spring Framework 5.3.18 and 5.3.20 is also available [6]. It is strongly recommended to upgrade as soon as possible. \n\nRegarding VMware products, the vendor has already made available security updates for the first two affected softwares but a permanent fix for VMware Tanzu Kubernetes Grid Integrated Edition is still in the works [3, 8]. Furthermore, VMWare has published workaround instructions designed to help administrators mitigate the issue on their systems until the patches are released [9].\n\nFor the `CVE-2022-22963` vulnerability, CERT-EU strongly recommends to upgrade to 3.1.7+ or 3.2.3+ to mitigate this RCE.\n\n## Mitigations\n\nIf patching of `CVE-2022-22965` is not immediately possible, the recommended approach is to apply the workaround in a more fail-safe way - applications could extend `RequestMappingHandlerAdapter` to update the `WebDataBinder` at the end after all other initialisation [6]. Other (earlier) attempts at the mitigations are also described in [2, 4].\n\nFinally, Randori Attack Team has proposed _non-malicious_ request to test the susceptibility for this vulnerability [5].\n\n# References\n\n\n[1] <https://sysdig.com/blog/cve-2022-22963-spring-cloud>\n\n[2] <https://www.praetorian.com/blog/spring-core-jdk9-rce/>\n\n[3] <https://www.vmware.com/security/advisories/VMSA-2022-0010.html>\n\n[4] <https://www.rapid7.com/blog/post/2022/03/30/spring4shell-zero-day-vulnerability-in-spring-framework/>\n\n[5] <https://twitter.com/RandoriAttack/status/1509298490106593283>\n\n[6] <https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement>\n\n[7] <https://tanzu.vmware.com/security/cve-2022-22965>\n\n[8] <https://www.bleepingcomputer.com/news/security/vmware-patches-spring4shell-rce-flaw-in-multiple-products/>\n\n[9] <https://kb.vmware.com/s/article/88102>",
  "content_html": "<p><em>History:</em></p><ul><li><em>31/03/2022 --- v1.0 -- Initial publication</em></li><li><em>31/03/2022 --- v1.1 -- Update with info about the patch</em> </li><li><em>05/04/2022 --- v1.2 -- Update with VMware Security patch</em></li></ul><h2 id=\"summary\">Summary</h2><p>On 29/03/2022, some cybersecurity analysts were alarmed following the publication of a few posts from a Chinese Twitter account. These tweets contained screenshots showing a 0-day exploit in Spring Core, a popular Java library. </p><p>The vulnerability has been assigned <code>CVE-2022-22965</code> [6, 7], and it is being referred to as <code>Spring4Shell</code> [2, 4]. The key points known at this time are:</p><ul><li>This vulnerability allows an unauthenticated attacker to execute arbitrary code on the targeted system.</li><li>Proofs-of-Concept (PoCs) of this vulnerability are <strong>publicly</strong> available. </li><li><strong>Patches have been released.</strong></li></ul><p>CERT-EU recommends to patch as soon as possible. </p><p>Additionally, another Spring vulnerability was also part of the recent discussions on the internet - assigned CVE number <code>CVE-2022-22963</code> (CVSS score 9.0) [1], it is a remote code execution vulnerability in Spring Cloud Function, which is a separate Java library from Spring Core. Public POCs are available [1]. CERT-EU recommend to also patch this vulnerability as soon as possible.</p><h2 id=\"technical-details\">Technical Details</h2><p><strong>Spring4Shell (<code>CVE-2022-22965</code>)</strong></p><p>The vulnerability impacts Spring MVC and Spring WebFlux applications running on JDK 9+. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it [6].</p><p>The exploitation of this vulnerability requires an endpoint with <em>DataBinder</em> enabled (e.g., a POST request that decodes data from the request body automatically) and depends heavily on the servlet container for the application. <em>For example, when Spring is deployed to Apache Tomcat, the <code>WebAppClassLoader</code> is accessible, which allows an attacker to call getters and setters to ultimately write a malicious JSP file to disk. However, if Spring is deployed using the Embedded Tomcat Servlet Container the classloader is a <code>LaunchedURLClassLoader</code> which has limited access</em> [2].</p><h2 id=\"affected-products\">Affected Products</h2><p>Specific requirements seem to be needed to be directly affected by <code>CVE-2022-22965</code> (Spring4Shell):</p><ul><li>JDK 9 or higher</li><li>Apache Tomcat as the Servlet container</li><li>Packaged as WAR</li><li><code>spring-webmvc</code> or <code>spring-webflux</code> dependency</li><li>Spring Framework versions 5.3.0 to 5.3.17, 5.2.0 to 5.2.19, and older versions</li></ul><p>Additionnaly, VMware has published security updates about its cloud computing and virtualization products that are impacted by this vulnerability [3]:</p><ul><li>VMware Tanzu Application Service for VMs – versions 2.10 to 2.13</li><li>VMware Tanzu Operations Manager – versions 2.8 to 2.10</li><li>VMware Tanzu Kubernetes Grid Integrated Edition (TKGI) – versions 1.11 to 1.13 </li></ul><p>Regarding the <code>CVE-2022-22963</code> :</p><ul><li>Spring Cloud Function <ul><li>3.1.6</li><li>3.2.2</li><li>Older, unsupported versions are also affected.</li></ul></li></ul><h2 id=\"recommendations-and-workarounds\">Recommendations and Workarounds</h2><p>Spring Framework versions 5.3.18 and 5.2.20, which address the <code>CVE-2022-22963</code> vulnerability, are now available on Maven Central. Spring Boot 2.5.12 with Spring Framework 5.3.18 and 5.3.20 is also available [6]. It is strongly recommended to upgrade as soon as possible. </p><p>Regarding VMware products, the vendor has already made available security updates for the first two affected softwares but a permanent fix for VMware Tanzu Kubernetes Grid Integrated Edition is still in the works [3, 8]. Furthermore, VMWare has published workaround instructions designed to help administrators mitigate the issue on their systems until the patches are released [9].</p><p>For the <code>CVE-2022-22963</code> vulnerability, CERT-EU strongly recommends to upgrade to 3.1.7+ or 3.2.3+ to mitigate this RCE.</p><h3 id=\"mitigations\">Mitigations</h3><p>If patching of <code>CVE-2022-22965</code> is not immediately possible, the recommended approach is to apply the workaround in a more fail-safe way - applications could extend <code>RequestMappingHandlerAdapter</code> to update the <code>WebDataBinder</code> at the end after all other initialisation [6]. Other (earlier) attempts at the mitigations are also described in [2, 4].</p><p>Finally, Randori Attack Team has proposed <em>non-malicious</em> request to test the susceptibility for this vulnerability [5].</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://sysdig.com/blog/cve-2022-22963-spring-cloud\">https://sysdig.com/blog/cve-2022-22963-spring-cloud</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.praetorian.com/blog/spring-core-jdk9-rce/\">https://www.praetorian.com/blog/spring-core-jdk9-rce/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.vmware.com/security/advisories/VMSA-2022-0010.html\">https://www.vmware.com/security/advisories/VMSA-2022-0010.html</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.rapid7.com/blog/post/2022/03/30/spring4shell-zero-day-vulnerability-in-spring-framework/\">https://www.rapid7.com/blog/post/2022/03/30/spring4shell-zero-day-vulnerability-in-spring-framework/</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://twitter.com/RandoriAttack/status/1509298490106593283\">https://twitter.com/RandoriAttack/status/1509298490106593283</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement\">https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://tanzu.vmware.com/security/cve-2022-22965\">https://tanzu.vmware.com/security/cve-2022-22965</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/vmware-patches-spring4shell-rce-flaw-in-multiple-products/\">https://www.bleepingcomputer.com/news/security/vmware-patches-spring4shell-rce-flaw-in-multiple-products/</a></p><p>[9] <a rel=\"noopener\" target=\"_blank\" href=\"https://kb.vmware.com/s/article/88102\">https://kb.vmware.com/s/article/88102</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}