{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2023-074.pdf"
  },
  "title": "HTTP/2 Rapid Reset DDoS Vulnerability",
  "serial_number": "2023-074",
  "publish_date": "17-10-2023 20:37:46",
  "description": "On October 10, 2023, Cloudflare, Google and Amazon AWS, jointly disclosed a vulnerability affecting the HTTP/2 protocol. Named as \"CVE-2023-44487\", this vulnerability impacts various web services and cloud customers. This vulnerability is being actively exploited and has led to Distributed Denial of Service (DDoS) attacks that are significantly larger than previous Layer 7 attacks.<br>\nCERT-EU recommends identifying all services using HTTP/2 that are exposed to the Internet, and apply patches or mitigations.<br>\n",
  "url_title": "2023-074",
  "content_markdown": "---\ntitle: 'HTTP/2 Rapid Reset DDoS Vulnerability'\nnumber: '2023-074'\nversion: '1.3'\noriginal_date: 'October 10, 2023'\ndate: 'October 10, 2023'\n---\n\n_History:_\n\n* _10/10/2023 --- v1.0 -- Initial publication_\n* _11/10/2023 --- v1.1 -- Information update based on vendor's advisories_\n* _12/10/2023 --- v1.2 -- Information update based on vendor's advisories_\n* _17/10/2023 --- v1.3 -- Information update based on vendor's advisories_\n\n# Summary\n\nOn October 10, 2023, Cloudflare, Google and Amazon AWS, jointly disclosed a vulnerability affecting the HTTP/2 protocol [1,2]. Named as `CVE-2023-44487`, this vulnerability impacts various web services and cloud customers. This vulnerability is being actively exploited and has led to Distributed Denial of Service (DDoS) attacks that are significantly larger than previous Layer 7 attacks.\n\nCERT-EU recommends identifying all services using HTTP/2 that are exposed to the Internet, and apply patches or mitigations.\n\n# Technical Details\n\nThe vulnerability exploits a weakness in the HTTP/2 protocol, allowing attackers to generate hyper-volumetric DDoS attacks. The attack involves sending a large number of HTTP/2 streams and immediately cancelling them, creating a cost asymmetry between the client and server. The attacker exploits the `RST_STREAM` and `GOAWAY` frames of the HTTP/2 protocol to manipulate the connection. This leaves the server doing significant work for cancelled requests while the client pays almost no costs.\n\n# Affected Products\n\nAll web services and products that use HTTP/2 protocol (nginx, apache, IIS, etc.). \n\n## Apache Tomcat\n\n- From version 8.5.0 to version 8.5.93 [3]\n\n## Kong\n\n**[UPDATE]** All supported versions of Kong Gateway, Kong Mesh, and Kuma have been patched [13]. The following versions contain a fix for the HTTP/2 rapid reset attack:\n\n- Kong Gateway Enterprise: 2.8.4.4, 3.1.1.6, 3.2.2.5, 3.3.1.1, 3.4.1.1\n- Kong Gateway OSS: 3.4.2\n- Kong Mesh: 2.0.8, 2.1.7, 2.2.5, 2.3.3, 2.4.3\n- Kuma: 2.0.8, 2.1.7, 2.2.5, 2.3.3, 2.4.3\n\n# Unaffected Products\n\nWeb applications protected by the following DDoS protection providers or Content Delivery Networks (CDNs) should not be impacted:\n\n- AWS [9]\n- Cloudflare [2]\n- Google Cloud [1]\n- Microsoft Azure [8]\n- HAProxy [10]\n\n# Detections\n\n## Testing if HTTP/2 is enabled\n\n### Openssl \n\n`echo 1 | openssl s_client -alpn h2 -connect google.com:443 -status 2>&1  | grep \"ALPN\"`\n\n### Nmap\n\n`nmap -p 443 --script=tls-nextprotoneg <www.google.com>`\n\n\n# Recommendations\n\n**[UPDATE]** Apache, Microsoft (IIS and MsQuic), and Kong have issued patches for this vulnerability. It is strongly recommended applying it as soon as possible.\n\nIf you are affected, it's recommended to:\n\n- Track connection statistics and identify abusive connections.\n- Close connections that exceed the concurrent stream limit, either immediately or after a small number of repeat offenses.\n- Implement forceful `GOAWAY` frames to limit stream creation immediately.\n- As a last resort, consider disabling HTTP/2 and HTTP/3 to mitigate the threat, although this may result in performance issues.\n\nOn the longer terms, it is recommended to use DDoS protection mechanisms.\n\n## Mitigations\n\nSince the vulnerability has been recently discovered, all vendors didn't provide advisories yet. This paper will be updated in the next days.\n\n### Nginx\n\nDisabling HTTP/2 in NGINX is not necessary. Simply ensure you have configured the following elements :\n\n- `keepalive_requests` should be kept at the default setting of 1000 requests\n- `http2_max_concurrent_streams` should be kept at the default setting of 128 streams\n- `limit_conn` enforces a limit on the number of connections allowed from a single client. This directive should be added with a reasonable setting balancing application performance and security.\n- `limit_req` enforces a limit on the number of requests that will be processed within a given amount of time from a single client. This directive should be added with a reasonable setting balancing application performance and security. [4]\n\nNginx plans to issue a patch that increases stability under these conditions.\n\n### Microsoft IIS and MsQuic\n\nMicrosoft published a security update as well as a workaround [7]. CERT-EU recommends using the workaround **only** if you're not able to install the latest updates.\n\nFurthermore, a patch for MsQuic product has been released. CERT-EU recommends updating the MsQuic servers as soon as possible. [12]\n\n### Netscaler \n\nNetscaler published recommendations to help reduce the load on backend servers behind Netscaler load balancing and content switching products. CERT-EU recommends carefully considering the impacts of the proposed workarounds before applying them.[11]\n\n### General remediations\n\nRemove reference to `http2` in the listening part of the web server configuration file.\n\n# References\n\n[1] <https://cloud.google.com/blog/products/identity-security/how-it-works-the-novel-http2-rapid-reset-ddos-attack?hl=en>\n\n[2] <https://blog.cloudflare.com/zero-day-rapid-reset-http2-record-breaking-ddos-attack/>\n\n[3] <https://tomcat.apache.org/security-8.html#Fixed_in_Apache_Tomcat_8.5.94>\n\n[4] <https://www.nginx.com/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products/>\n\n[5] <https://www.f5.com/company/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products>\n\n[6] <https://gist.github.com/adulau/7c2bfb8e9cdbe4b35a5e131c66a0c088>\n\n[7] <https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-44487>\n\n[8] <https://msrc.microsoft.com/blog/2023/10/microsoft-response-to-distributed-denial-of-service-ddos-attacks-against-http/2/>\n\n[9] <https://aws.amazon.com/blogs/security/how-aws-protects-customers-from-ddos-events/>\n\n[10] <https://www.haproxy.com/blog/haproxy-is-not-affected-by-the-http-2-rapid-reset-attack-cve-2023-44487>\n\n[11] <https://www.netscaler.com/blog/news/how-to-mitigate-the-http-2-rapid-reset-vulnerability-on-netscaler/>\n\n[12] <https://github.com/microsoft/msquic/releases/tag/v2.2.3>\n\n[13] <https://konghq.com/blog/product-releases/novel-http2-rapid-reset-ddos-vulnerability-update>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>10/10/2023 --- v1.0 -- Initial publication</em></li><li><em>11/10/2023 --- v1.1 -- Information update based on vendor's advisories</em></li><li><em>12/10/2023 --- v1.2 -- Information update based on vendor's advisories</em></li><li><em>17/10/2023 --- v1.3 -- Information update based on vendor's advisories</em></li></ul><h2 id=\"summary\">Summary</h2><p>On October 10, 2023, Cloudflare, Google and Amazon AWS, jointly disclosed a vulnerability affecting the HTTP/2 protocol [1,2]. Named as <code>CVE-2023-44487</code>, this vulnerability impacts various web services and cloud customers. This vulnerability is being actively exploited and has led to Distributed Denial of Service (DDoS) attacks that are significantly larger than previous Layer 7 attacks.</p><p>CERT-EU recommends identifying all services using HTTP/2 that are exposed to the Internet, and apply patches or mitigations.</p><h2 id=\"technical-details\">Technical Details</h2><p>The vulnerability exploits a weakness in the HTTP/2 protocol, allowing attackers to generate hyper-volumetric DDoS attacks. The attack involves sending a large number of HTTP/2 streams and immediately cancelling them, creating a cost asymmetry between the client and server. The attacker exploits the <code>RST_STREAM</code> and <code>GOAWAY</code> frames of the HTTP/2 protocol to manipulate the connection. This leaves the server doing significant work for cancelled requests while the client pays almost no costs.</p><h2 id=\"affected-products\">Affected Products</h2><p>All web services and products that use HTTP/2 protocol (nginx, apache, IIS, etc.). </p><h3 id=\"apache-tomcat\">Apache Tomcat</h3><ul><li>From version 8.5.0 to version 8.5.93 [3]</li></ul><h3 id=\"kong\">Kong</h3><p><strong>[UPDATE]</strong> All supported versions of Kong Gateway, Kong Mesh, and Kuma have been patched [13]. The following versions contain a fix for the HTTP/2 rapid reset attack:</p><ul><li>Kong Gateway Enterprise: 2.8.4.4, 3.1.1.6, 3.2.2.5, 3.3.1.1, 3.4.1.1</li><li>Kong Gateway OSS: 3.4.2</li><li>Kong Mesh: 2.0.8, 2.1.7, 2.2.5, 2.3.3, 2.4.3</li><li>Kuma: 2.0.8, 2.1.7, 2.2.5, 2.3.3, 2.4.3</li></ul><h2 id=\"unaffected-products\">Unaffected Products</h2><p>Web applications protected by the following DDoS protection providers or Content Delivery Networks (CDNs) should not be impacted:</p><ul><li>AWS [9]</li><li>Cloudflare [2]</li><li>Google Cloud [1]</li><li>Microsoft Azure [8]</li><li>HAProxy [10]</li></ul><h2 id=\"detections\">Detections</h2><h3 id=\"testing-if-http2-is-enabled\">Testing if HTTP/2 is enabled</h3><h4 id=\"openssl\">Openssl</h4><p><code>echo 1 | openssl s_client -alpn h2 -connect google.com:443 -status 2&gt;&amp;1 | grep \"ALPN\"</code></p><h4 id=\"nmap\">Nmap</h4><p><code>nmap -p 443 --script=tls-nextprotoneg &lt;www.google.com&gt;</code></p><h2 id=\"recommendations\">Recommendations</h2><p><strong>[UPDATE]</strong> Apache, Microsoft (IIS and MsQuic), and Kong have issued patches for this vulnerability. It is strongly recommended applying it as soon as possible.</p><p>If you are affected, it's recommended to:</p><ul><li>Track connection statistics and identify abusive connections.</li><li>Close connections that exceed the concurrent stream limit, either immediately or after a small number of repeat offenses.</li><li>Implement forceful <code>GOAWAY</code> frames to limit stream creation immediately.</li><li>As a last resort, consider disabling HTTP/2 and HTTP/3 to mitigate the threat, although this may result in performance issues.</li></ul><p>On the longer terms, it is recommended to use DDoS protection mechanisms.</p><h3 id=\"mitigations\">Mitigations</h3><p>Since the vulnerability has been recently discovered, all vendors didn't provide advisories yet. This paper will be updated in the next days.</p><h4 id=\"nginx\">Nginx</h4><p>Disabling HTTP/2 in NGINX is not necessary. Simply ensure you have configured the following elements :</p><ul><li><code>keepalive_requests</code> should be kept at the default setting of 1000 requests</li><li><code>http2_max_concurrent_streams</code> should be kept at the default setting of 128 streams</li><li><code>limit_conn</code> enforces a limit on the number of connections allowed from a single client. This directive should be added with a reasonable setting balancing application performance and security.</li><li><code>limit_req</code> enforces a limit on the number of requests that will be processed within a given amount of time from a single client. This directive should be added with a reasonable setting balancing application performance and security. [4]</li></ul><p>Nginx plans to issue a patch that increases stability under these conditions.</p><h4 id=\"microsoft-iis-and-msquic\">Microsoft IIS and MsQuic</h4><p>Microsoft published a security update as well as a workaround [7]. CERT-EU recommends using the workaround <strong>only</strong> if you're not able to install the latest updates.</p><p>Furthermore, a patch for MsQuic product has been released. CERT-EU recommends updating the MsQuic servers as soon as possible. [12]</p><h4 id=\"netscaler\">Netscaler</h4><p>Netscaler published recommendations to help reduce the load on backend servers behind Netscaler load balancing and content switching products. CERT-EU recommends carefully considering the impacts of the proposed workarounds before applying them.[11]</p><h4 id=\"general-remediations\">General remediations</h4><p>Remove reference to <code>http2</code> in the listening part of the web server configuration file.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://cloud.google.com/blog/products/identity-security/how-it-works-the-novel-http2-rapid-reset-ddos-attack?hl=en\">https://cloud.google.com/blog/products/identity-security/how-it-works-the-novel-http2-rapid-reset-ddos-attack?hl=en</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://blog.cloudflare.com/zero-day-rapid-reset-http2-record-breaking-ddos-attack/\">https://blog.cloudflare.com/zero-day-rapid-reset-http2-record-breaking-ddos-attack/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://tomcat.apache.org/security-8.html#Fixed_in_Apache_Tomcat_8.5.94\">https://tomcat.apache.org/security-8.html#Fixed_in_Apache_Tomcat_8.5.94</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.nginx.com/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products/\">https://www.nginx.com/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products/</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.f5.com/company/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products\">https://www.f5.com/company/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://gist.github.com/adulau/7c2bfb8e9cdbe4b35a5e131c66a0c088\">https://gist.github.com/adulau/7c2bfb8e9cdbe4b35a5e131c66a0c088</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-44487\">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-44487</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://msrc.microsoft.com/blog/2023/10/microsoft-response-to-distributed-denial-of-service-ddos-attacks-against-http/2/\">https://msrc.microsoft.com/blog/2023/10/microsoft-response-to-distributed-denial-of-service-ddos-attacks-against-http/2/</a></p><p>[9] <a rel=\"noopener\" target=\"_blank\" href=\"https://aws.amazon.com/blogs/security/how-aws-protects-customers-from-ddos-events/\">https://aws.amazon.com/blogs/security/how-aws-protects-customers-from-ddos-events/</a></p><p>[10] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.haproxy.com/blog/haproxy-is-not-affected-by-the-http-2-rapid-reset-attack-cve-2023-44487\">https://www.haproxy.com/blog/haproxy-is-not-affected-by-the-http-2-rapid-reset-attack-cve-2023-44487</a></p><p>[11] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.netscaler.com/blog/news/how-to-mitigate-the-http-2-rapid-reset-vulnerability-on-netscaler/\">https://www.netscaler.com/blog/news/how-to-mitigate-the-http-2-rapid-reset-vulnerability-on-netscaler/</a></p><p>[12] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/microsoft/msquic/releases/tag/v2.2.3\">https://github.com/microsoft/msquic/releases/tag/v2.2.3</a></p><p>[13] <a rel=\"noopener\" target=\"_blank\" href=\"https://konghq.com/blog/product-releases/novel-http2-rapid-reset-ddos-vulnerability-update\">https://konghq.com/blog/product-releases/novel-http2-rapid-reset-ddos-vulnerability-update</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}