{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2024-101.pdf"
  },
  "title": "Critical SAML Authentication Bypass in Gitlab",
  "serial_number": "2024-101",
  "publish_date": "19-09-2024 12:06:27",
  "description": "On September 17, 2024, GitLab issued a security advisory addressing a critical vulnerability identified in GitLab’s SAML authentication implementation, potentially allowing attackers to bypass authentication. The vulnerability affects the Community Edition (CE) and the Enterprise Edition (EE) instances that utilise SAML for single sign-on (SSO).<br>\nIt is recommended updating affected servers as soon as possible, and searching for potential successful exploitation of the vulnerability in the logs.<br>\n",
  "url_title": "2024-101",
  "content_markdown": "---    \ntitle: 'Critical SAML Authentication Bypass in Gitlab'\nnumber: '2024-101'\nversion: '1.0'\noriginal_date: '2024-09-17'\ndate: '2024-09-19'\n---\n\n_History:_\n\n* _19/09/2024 --- v1.0 -- Initial publication_\n\n# Summary\n\nOn September 17, 2024, GitLab issued a security advisory addressing a critical vulnerability identified in GitLab’s SAML authentication implementation, potentially allowing attackers to bypass authentication. The vulnerability affects the Community Edition (CE) and the Enterprise Edition (EE) instances that utilise SAML for single sign-on (SSO) [1,2].\n\nIt is recommended updating affected servers as soon as possible, and searching for potential successful exploitation of the vulnerability in the logs.\n\n# Technical Details\n\nThe vulnerability **CVE-2024-45409**, with a CVSS score of 10, arises from improper validation of SAML assertions, particularly the `extern_uid`, which uniquely identifies users. When a malicious SAML response is crafted, GitLab fails to verify critical elements in the SAML assertion, thus allowing the attacker to impersonate a legitimate user on the affected server. This vulnerability is due to issues in the OmniAuth-SAML and Ruby-SAML libraries. It was fixed by upgrading OmniAuth-SAML to version 2.2.1 and Ruby-SAML to 1.17.0.\n\n# Affected Products\n\nThe vulnerability affects GitLab CE and EE versions **prior to 17.3.3, 17.2.7, 17.1.8, 17.0.8, and 16.11.10** which have configured SAML based authentication [1].\n\n# Recommendations\n\nCERT-EU strongly recommends updating affected GitLab CE and EE instances to a fixed version. It is also strongly advised to enforce Multi-Factor Authentication (MFA) for all accounts and enable the \"Do not allow SAML 2FA bypass\" setting to prevent attackers from bypassing the MFA requirement [1].\n\nMoreover, it is recommended searching for potential exploitation of the vulnerability in the logs especially for Internet facing instances.\n\n## Detection \n\nIt is possible to detect a successful exploitation of the vulnerability in the `application_json` log file. It requires to review the `extern_uid` field attributes for unusual values. It is also possible to validate the findings by reviewing the corresponding SAML response, in the `auth_json` log file, by searching for incorrect or missing information in the `attributes` section [1].\n\nGitlab Security Engineering provides two detection methods that could be adapted to detect users with more than one unique `extern_uid` over time, and SAML authentication events from a different IP address than other identity provider (IdP) events for the same user over time.\n\n# References\n\n[1] <https://about.gitlab.com/releases/2024/09/17/patch-release-gitlab-17-3-3-released/>\n\n[2] <https://www.bleepingcomputer.com/news/security/gitlab-releases-fix-for-critical-saml-authentication-bypass-flaw/>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>19/09/2024 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On September 17, 2024, GitLab issued a security advisory addressing a critical vulnerability identified in GitLab’s SAML authentication implementation, potentially allowing attackers to bypass authentication. The vulnerability affects the Community Edition (CE) and the Enterprise Edition (EE) instances that utilise SAML for single sign-on (SSO) [1,2].</p><p>It is recommended updating affected servers as soon as possible, and searching for potential successful exploitation of the vulnerability in the logs.</p><h2 id=\"technical-details\">Technical Details</h2><p>The vulnerability <strong>CVE-2024-45409</strong>, with a CVSS score of 10, arises from improper validation of SAML assertions, particularly the <code>extern_uid</code>, which uniquely identifies users. When a malicious SAML response is crafted, GitLab fails to verify critical elements in the SAML assertion, thus allowing the attacker to impersonate a legitimate user on the affected server. This vulnerability is due to issues in the OmniAuth-SAML and Ruby-SAML libraries. It was fixed by upgrading OmniAuth-SAML to version 2.2.1 and Ruby-SAML to 1.17.0.</p><h2 id=\"affected-products\">Affected Products</h2><p>The vulnerability affects GitLab CE and EE versions <strong>prior to 17.3.3, 17.2.7, 17.1.8, 17.0.8, and 16.11.10</strong> which have configured SAML based authentication [1].</p><h2 id=\"recommendations\">Recommendations</h2><p>CERT-EU strongly recommends updating affected GitLab CE and EE instances to a fixed version. It is also strongly advised to enforce Multi-Factor Authentication (MFA) for all accounts and enable the \"Do not allow SAML 2FA bypass\" setting to prevent attackers from bypassing the MFA requirement [1].</p><p>Moreover, it is recommended searching for potential exploitation of the vulnerability in the logs especially for Internet facing instances.</p><h3 id=\"detection\">Detection</h3><p>It is possible to detect a successful exploitation of the vulnerability in the <code>application_json</code> log file. It requires to review the <code>extern_uid</code> field attributes for unusual values. It is also possible to validate the findings by reviewing the corresponding SAML response, in the <code>auth_json</code> log file, by searching for incorrect or missing information in the <code>attributes</code> section [1].</p><p>Gitlab Security Engineering provides two detection methods that could be adapted to detect users with more than one unique <code>extern_uid</code> over time, and SAML authentication events from a different IP address than other identity provider (IdP) events for the same user over time.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://about.gitlab.com/releases/2024/09/17/patch-release-gitlab-17-3-3-released/\">https://about.gitlab.com/releases/2024/09/17/patch-release-gitlab-17-3-3-released/</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.bleepingcomputer.com/news/security/gitlab-releases-fix-for-critical-saml-authentication-bypass-flaw/\">https://www.bleepingcomputer.com/news/security/gitlab-releases-fix-for-critical-saml-authentication-bypass-flaw/</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}