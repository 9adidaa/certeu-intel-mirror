{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2024-037.pdf"
  },
  "title": "Critical Vulnerability in PAN-OS software",
  "serial_number": "2024-037",
  "publish_date": "29-04-2024 10:45:35",
  "description": "On April 12, 2024, Palo Alto Networks released a security advisory for a critical vulnerability affecting a feature of PAN-OS software. This vulnerability allows an unauthenticated remote attacker to execute arbitrary code as root on the affected device.<br>\nThis vulnerability is being exploited in the wild, and proof-of-concepts have been publicly disclosed by third parties. The vendor is gradually releasing patches for the vulnerable versions since April 14, 2024. However, the patches are not available for all the affected versions yet. In this case, it is highly recommended to apply the mitigation measures, as well as implementing the verification steps suggested by the vendor.<br>\n",
  "url_title": "2024-037",
  "content_markdown": "---\ntitle: 'Critical Vulnerability in PAN-OS software'\nnumber: '2024-037'\nversion: '1.3'\noriginal_date: 'April 12, 2024'\ndate: 'April 29, 2024'\n---\n\n_History:_\n\n* _12/04/2024 --- v1.0 -- Initial publication_\n* _16/04/2024 --- v1.1 -- Add patch information_\n* _17/04/2024 --- v1.2 -- Add information about vulnerable configurations, and detection opportunities_\n* _29/04/2024 --- v1.3 -- Update recommendations and detection opportunities_\n\n\n# Summary\n\nOn April 12, 2024, Palo Alto Networks released a security advisory for a critical vulnerability affecting a feature of PAN-OS software. This vulnerability allows an unauthenticated remote attacker to execute arbitrary code as root on the affected device [1].\n\nThis vulnerability is **being exploited in the wild**, and proof-of-concepts have been publicly disclosed by third parties [4]. The vendor is gradually releasing patches for the vulnerable versions since April 14, 2024. However, the patches are not available for all the affected versions yet. In this case, it is highly recommended to apply the mitigation measures, as well as implementing the verification steps suggested by the vendor.\n\n# Technical Details\n\nThe vulnerability tracked as **CVE-2024-3400** and with a **CVSS score of 10.0** is a command injection vulnerability in the GlobalProtect feature of Palo Alto Networks PAN-OS software. If exploited, it may allow an unauthenticated remote attacker to execute arbitrary code with root privileges on the firewall.\n\n# Affected Products\n\nThe following product versions are affected:\n\n- PAN-OS 11.1 before version 11.1.2-h3\n- PAN-OS 11.0 before version 11.0.4-h1\n- PAN-OS 10.2 before version 10.2.9-h1\n- PAN-OS 10.2 before version 10.2.8-h3\n- PAN-OS 10.2 before version 10.2.7-h8\n\nContrary to the initial statements, this issue is applicable only to affected versions of the product configured with GlobalProtect gateway or GlobalProtect portal (or both). Device telemetry does not need to be enabled for PAN-OS firewalls to be exposed to attacks related to this vulnerability. One can verify whether the GlobalProtect gateway or GlobalProtect portal is configured by checking for entries in the firewall web interface (Network > GlobalProtect > Gateways or Network > GlobalProtect > Portals) [1].\n\n# Recommendations\n\n**[Updated]** CERT-EU strongly recommends taking remediation actions depending on the exploitation level found on affected devices [5]:\n\n- **Level 0 - probing**: Unsuccessful exploitation attempt.\n    - Update to the latest PAN-OS hotfix;\n    - Create a master key [6], and  elect AES-256-GCM [7].\n- **Level 1 - test**: Vulnerability being tested on the device, a 0-byte file has been created and is resident on the firewall, no indication of any known unauthorised command execution.\n    - Update to the latest PAN-OS hotfix.\n    - Create a master key [6], and  elect AES-256-GCM [7].\n- **Level 2 - potential exfiltration**:  file on the device has been copied to a location accessible via a web request, though the file may or may not have been subsequently downloaded. Typically, the file we have observed being copied is `running_config.xml`. The suggested remediation will eliminate the possibility of capturing forensic artefacts.\n    - Engage incident response and isolate the device to be able to determine what was done on the device.\n    - Once it is done, update to the latest PAN-OS hotfix and perform a Private Data Reset [8].\n- **Level 3 - interactive access**: Interactive command execution:  May include shell-based back doors, introduction of code, pulling files, running commands. The suggested remediation will eliminate the possibility of capturing Forensic Artifacts.\n    - Engage incident response and isolate the device to be able to determine what was done on the device, and in the network (in case of lateral movement).\n    - Once it is done, update to the latest PAN-OS hotfix and perform a Factory Reset [8].\n\n**[Updated]** To identify the exploitation level of a device, it is advised following the verification steps suggested by the vendor described below [1]. Some mitigation steps are also available, and are described below.\n\n## Threat Prevention Based Mitigation\n\nCustomers with a Threat Prevention subscription can block attacks for this vulnerability by enabling Threat ID 95187 (introduced in Applications and Threats content version 8833-8682).\n\nIn addition to enabling Threat ID 95187, customers must ensure vulnerability protection has been applied to their GlobalProtect interface to prevent exploitation of this issue on their device [2].\n\n## Detection Opportunities\n\nThe following command can be used from the PAN-OS CLI to help identify indicators of exploit activity on the device [1]:\n\n```\ngrep pattern \"failed to unmarshal session(.\\+.\\/\" mp-log gpsvc.log*\n```\n\nBenign `failed to unmarshal session` error logs typically appear like the following entry:\n\n```\n\"message\":\"failed to unmarshal session(01234567-89ab-cdef-1234-567890abcdef)\"\n```\n\nIf the value between `session(` and `)` does not look like a GUID (the format shown above), but instead contains a file system path, this indicates the need for further investigation and the log entry could be related to the successful or unsuccessful exploitation of CVE-2024-3400.\n\n**[New]** Additional information provided by Volexity [9] and Unit42 [4] could be used to determine the exploitation level of an affected device.\n\n# References\n\n[1] <https://security.paloaltonetworks.com/CVE-2024-3400>\n\n[2] <https://live.paloaltonetworks.com/t5/globalprotect-articles/applying-vulnerability-protection-to-globalprotect-interfaces/ta-p/340184>\n\n[3] <https://docs.paloaltonetworks.com/pan-os/11-0/pan-os-admin/device-telemetry/device-telemetry-configure/device-telemetry-disable>\n\n[4] <https://unit42.paloaltonetworks.com/cve-2024-3400/>\n\n[5] <https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK>\n\n[6] <https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/configure-the-master-key>\n\n[7] <https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/master-key-encryption/configure-the-master-key-encryption-level#ida38d799c-29bb-4b3e-a7fd-f968b8affa64:~:text=DOWNLOAD%20PDF-,Configure%20Master%20Key%20Encryption%20Level,-Previous>\n\n[8] <https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u0000008XrDCAU>\n\n[9] <https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/>",
  "content_html": "<p><em>History:</em></p><ul><li><em>12/04/2024 --- v1.0 -- Initial publication</em></li><li><em>16/04/2024 --- v1.1 -- Add patch information</em></li><li><em>17/04/2024 --- v1.2 -- Add information about vulnerable configurations, and detection opportunities</em></li><li><em>29/04/2024 --- v1.3 -- Update recommendations and detection opportunities</em></li></ul><h2 id=\"summary\">Summary</h2><p>On April 12, 2024, Palo Alto Networks released a security advisory for a critical vulnerability affecting a feature of PAN-OS software. This vulnerability allows an unauthenticated remote attacker to execute arbitrary code as root on the affected device [1].</p><p>This vulnerability is <strong>being exploited in the wild</strong>, and proof-of-concepts have been publicly disclosed by third parties [4]. The vendor is gradually releasing patches for the vulnerable versions since April 14, 2024. However, the patches are not available for all the affected versions yet. In this case, it is highly recommended to apply the mitigation measures, as well as implementing the verification steps suggested by the vendor.</p><h2 id=\"technical-details\">Technical Details</h2><p>The vulnerability tracked as <strong>CVE-2024-3400</strong> and with a <strong>CVSS score of 10.0</strong> is a command injection vulnerability in the GlobalProtect feature of Palo Alto Networks PAN-OS software. If exploited, it may allow an unauthenticated remote attacker to execute arbitrary code with root privileges on the firewall.</p><h2 id=\"affected-products\">Affected Products</h2><p>The following product versions are affected:</p><ul><li>PAN-OS 11.1 before version 11.1.2-h3</li><li>PAN-OS 11.0 before version 11.0.4-h1</li><li>PAN-OS 10.2 before version 10.2.9-h1</li><li>PAN-OS 10.2 before version 10.2.8-h3</li><li>PAN-OS 10.2 before version 10.2.7-h8</li></ul><p>Contrary to the initial statements, this issue is applicable only to affected versions of the product configured with GlobalProtect gateway or GlobalProtect portal (or both). Device telemetry does not need to be enabled for PAN-OS firewalls to be exposed to attacks related to this vulnerability. One can verify whether the GlobalProtect gateway or GlobalProtect portal is configured by checking for entries in the firewall web interface (Network &gt; GlobalProtect &gt; Gateways or Network &gt; GlobalProtect &gt; Portals) [1].</p><h2 id=\"recommendations\">Recommendations</h2><p><strong>[Updated]</strong> CERT-EU strongly recommends taking remediation actions depending on the exploitation level found on affected devices [5]:</p><ul><li><strong>Level 0 - probing</strong>: Unsuccessful exploitation attempt. <ul><li>Update to the latest PAN-OS hotfix;</li><li>Create a master key [6], and elect AES-256-GCM [7].</li></ul></li><li><strong>Level 1 - test</strong>: Vulnerability being tested on the device, a 0-byte file has been created and is resident on the firewall, no indication of any known unauthorised command execution. <ul><li>Update to the latest PAN-OS hotfix.</li><li>Create a master key [6], and elect AES-256-GCM [7].</li></ul></li><li><strong>Level 2 - potential exfiltration</strong>: file on the device has been copied to a location accessible via a web request, though the file may or may not have been subsequently downloaded. Typically, the file we have observed being copied is <code>running_config.xml</code>. The suggested remediation will eliminate the possibility of capturing forensic artefacts. <ul><li>Engage incident response and isolate the device to be able to determine what was done on the device.</li><li>Once it is done, update to the latest PAN-OS hotfix and perform a Private Data Reset [8].</li></ul></li><li><strong>Level 3 - interactive access</strong>: Interactive command execution: May include shell-based back doors, introduction of code, pulling files, running commands. The suggested remediation will eliminate the possibility of capturing Forensic Artifacts. <ul><li>Engage incident response and isolate the device to be able to determine what was done on the device, and in the network (in case of lateral movement).</li><li>Once it is done, update to the latest PAN-OS hotfix and perform a Factory Reset [8].</li></ul></li></ul><p><strong>[Updated]</strong> To identify the exploitation level of a device, it is advised following the verification steps suggested by the vendor described below [1]. Some mitigation steps are also available, and are described below.</p><h3 id=\"threat-prevention-based-mitigation\">Threat Prevention Based Mitigation</h3><p>Customers with a Threat Prevention subscription can block attacks for this vulnerability by enabling Threat ID 95187 (introduced in Applications and Threats content version 8833-8682).</p><p>In addition to enabling Threat ID 95187, customers must ensure vulnerability protection has been applied to their GlobalProtect interface to prevent exploitation of this issue on their device [2].</p><h3 id=\"detection-opportunities\">Detection Opportunities</h3><p>The following command can be used from the PAN-OS CLI to help identify indicators of exploit activity on the device [1]:</p><pre><code>grep pattern \"failed to unmarshal session(.\\+.\\/\" mp-log gpsvc.log*\n</code></pre><p>Benign <code>failed to unmarshal session</code> error logs typically appear like the following entry:</p><pre><code>\"message\":\"failed to unmarshal session(01234567-89ab-cdef-1234-567890abcdef)\"\n</code></pre><p>If the value between <code>session(</code> and <code>)</code> does not look like a GUID (the format shown above), but instead contains a file system path, this indicates the need for further investigation and the log entry could be related to the successful or unsuccessful exploitation of CVE-2024-3400.</p><p><strong>[New]</strong> Additional information provided by Volexity [9] and Unit42 [4] could be used to determine the exploitation level of an affected device.</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://security.paloaltonetworks.com/CVE-2024-3400\">https://security.paloaltonetworks.com/CVE-2024-3400</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://live.paloaltonetworks.com/t5/globalprotect-articles/applying-vulnerability-protection-to-globalprotect-interfaces/ta-p/340184\">https://live.paloaltonetworks.com/t5/globalprotect-articles/applying-vulnerability-protection-to-globalprotect-interfaces/ta-p/340184</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://docs.paloaltonetworks.com/pan-os/11-0/pan-os-admin/device-telemetry/device-telemetry-configure/device-telemetry-disable\">https://docs.paloaltonetworks.com/pan-os/11-0/pan-os-admin/device-telemetry/device-telemetry-configure/device-telemetry-disable</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://unit42.paloaltonetworks.com/cve-2024-3400/\">https://unit42.paloaltonetworks.com/cve-2024-3400/</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK\">https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u000000CrO6CAK</a></p><p>[6] <a rel=\"noopener\" target=\"_blank\" href=\"https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/configure-the-master-key\">https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/configure-the-master-key</a></p><p>[7] <a rel=\"noopener\" target=\"_blank\" href=\"https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/master-key-encryption/configure-the-master-key-encryption-level#ida38d799c-29bb-4b3e-a7fd-f968b8affa64:~:text=DOWNLOAD%20PDF-,Configure%20Master%20Key%20Encryption%20Level,-Previous\">https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/certificate-management/master-key-encryption/configure-the-master-key-encryption-level#ida38d799c-29bb-4b3e-a7fd-f968b8affa64:~:text=DOWNLOAD%20PDF-,Configure%20Master%20Key%20Encryption%20Level,-Previous</a></p><p>[8] <a rel=\"noopener\" target=\"_blank\" href=\"https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u0000008XrDCAU\">https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA14u0000008XrDCAU</a></p><p>[9] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/\">https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}