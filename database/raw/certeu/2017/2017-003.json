{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2017-003.pdf"
  },
  "title": "CISCO Smart Install Protocol Issues",
  "serial_number": "2017-003",
  "publish_date": "22-02-2017 14:28:00",
  "description": "It has been reported that there exists a way to misuse the Cisco Smart Install protocol messages. The misuse is directed towards Smart Install Clients allowing an unauthenticated remote attacker to change the startup configuration, load alternative IOS versions, and execute commands on affected devices. Cisco does not consider this issue a vulnerability. However, since Cisco Smart Install is enabled by default in a big number of modern switches and routers, CERT-EU considers this protocol abuse a potentially serious threat.",
  "url_title": "2017-003",
  "content_markdown": "---\ntitle: 'Cisco Smart Install Protocol Issues'\nversion: '1.0'\nnumber: '2017-003'\ndate: 'February 22, 2017'\nfontsize: '11pt'\n---\n\n_History:_\n\n* _22/02/2017 --- v1.0 -- Initial publication_\n\n\n# Summary\n\nSeveral researchers (e.g., in [4]) and CERT/CSIRTs have reported on the misuse of Cisco Smart Install (SMI) [1] protocol messages. The misuse is directed towards _**Smart Install Clients**_ allowing an unauthenticated remote attacker to:\n\n* obtain and change the startup-config file and force a reload of the device,\n* load a new IOS image on the device, and execute high-privilege CLI commands on switches running Cisco IOS and IOS XE Software.\n\nCisco devices that are configured as a _Smart Install Director_ are not affected by these attacks.\n\nCisco does not consider this issue a vulnerability in Cisco IOS, IOS XE, or the Smart Install feature itself, but a **misuse** of the Smart Install protocol, which does not require authentication by design. However, since Cisco Smart Install (SMI) is enabled by default in a big number of modern switches and routers, CERT-EU considers this protocol abuse a potentially **serious threat**.\n\n# Technical Details\n\nSmart Install is a _plug-and-play_ configuration and image-management feature that provides zero-touch deployment for new switches. The Smart Install feature incorporates no authentication by design.\n\nSmartInstall also has mechanisms in place for subsequent Cisco IOS Software and configuration upgrades on groups of switches, using a single command line interface (CLI) and switch replacement assistance. It can perform a configuration backup when a switch changes its configuration.\n\nA Smart Install network consists of exactly one _Smart Install Director_ switch or router, also known as an _integrated branch director_ (IBD), and one or more _Smart Install Client_ switches, also known as _integrated branch clients_ (IBCs). A client switch does not need to be directly connected to the director but can be up to seven hops away.\n\n## Main Components of the Smart Install Network\n\nThe _Director_ builds a topology database for the network by collecting information from the network Smart Install switches.\n\nThe director uses the database:\n\n* To assign a configuration file and image to a client.\n* As a reference to obtain the PID, the image name, and the configuration file for an on-demand update of network switches.\n\nSmart Install network uses DHCP server to assign IP addresses for transfer of specific parameters.\n\nSmart Install relies on a TFTP server to store image and configuration files. The TFTP server can be an external device, or the director can act as a TFTP server.\n\nClient switches have a direct or indirect connection to the director so that they can receive image and configuration downloads from it.\n\n## Issues Identified\n\nKnowing the characteristics of the protocol, the researchers have managed to [4]:\n\n* Change the TFTP server address on a client device by sending one malformed TCP packet.\n* Copy client's startup-config to the new TFTP server.\n* Substitute client's startup-config with another, manually modified one. Client device will then reboot at predefined time.\n* Upgrade IOS image on the client device.\n* Execute random set of commands on the client device (it is a new feature working only at 3.6.0E and 15.2(2)E IOS versions).\n\nA proof of concept is available [5].\n\n# Products Affected\n\nAn extensive list (50+) of affected switches and routers can be found in [3].\n\n# Recommendations\n\n* Cisco has updated the Smart Install Description chapter in the _Cisco Smart Install Configuration Guide_ [2] to include _Security Best Practices_ when deploying Cisco Smart Install functionality.\n* The protocol does not require authentication by design, and the suggested best practices should be applied depending on how the feature is used in a specific customer environment.\n* Organizations that are not leveraging the Smart Install feature, or using it purely for zero-touch deployment, should disable the Smart Install feature once the switch has been deployed with the configuration command `no vstack`.\n* Where the `no vstack` command is not available (old versions), organizations should ensure that only the IB Director has TCP connectivity to all IB Clients on port 4786, by using:\n\t* interface access control lists (ACLs),\n\t* Control Plane Policing (CoPP is not available on all Cisco IOS Software releases).\n* Organizations that are seeking more than just zero-touch deployment, or need the added security of authorization and authentication between the director and clients, can migrate to Cisco Plug-N-Play (PnP).\n* Segment the network into multiple zones focusing specifically on separating the management network segment.\n\n## Mitigations Summary\n\n| **Use Case** | **Mitigation** |\n|-------------------------------------------------------------|------------------------------|\n| - Customers not using the Smart Install feature. | - Disable (`no vstack`). |\n|-----------------------------------------------------------------------------------|----------------------------------|\n| - Customers leveraging the Smart Install feature only for zero-touch deployment. | - Disable (`no vstack`) after initial deployment. |\n|-----------------------------------------------------------------------------------|----------------------------------|\n| - Customers leveraging the Smart Install feature for more than zero-touch deployment (configuration and image-management). | - Interface access control lists (ACLs). |\n| - Customers running old versions. | - Control Plane Policing (CoPP). |\n\n\n# References\n\n[1] <https://tools.cisco.com/security/center/content/CiscoSecurityResponse/cisco-sr-20170214-smi>\n\n[2] <http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-3750-x-series-switches/white_paper_c11-651895.html>\n\n[3] <http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html#51890>\n\n[4] <https://2016.zeronights.ru/wp-content/uploads/2016/12/CiscoSmartInstall.v3.pdf>\n\n[5] <https://github.com/Sab0tag3d/SIET>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>22/02/2017 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>Several researchers (e.g., in [4]) and CERT/CSIRTs have reported on the misuse of Cisco Smart Install (SMI) [1] protocol messages. The misuse is directed towards <em><strong>Smart Install Clients</strong></em> allowing an unauthenticated remote attacker to:</p><ul><li>obtain and change the startup-config file and force a reload of the device,</li><li>load a new IOS image on the device, and execute high-privilege CLI commands on switches running Cisco IOS and IOS XE Software.</li></ul><p>Cisco devices that are configured as a <em>Smart Install Director</em> are not affected by these attacks.</p><p>Cisco does not consider this issue a vulnerability in Cisco IOS, IOS XE, or the Smart Install feature itself, but a <strong>misuse</strong> of the Smart Install protocol, which does not require authentication by design. However, since Cisco Smart Install (SMI) is enabled by default in a big number of modern switches and routers, CERT-EU considers this protocol abuse a potentially <strong>serious threat</strong>.</p><h2 id=\"technical-details\">Technical Details</h2><p>Smart Install is a <em>plug-and-play</em> configuration and image-management feature that provides zero-touch deployment for new switches. The Smart Install feature incorporates no authentication by design.</p><p>SmartInstall also has mechanisms in place for subsequent Cisco IOS Software and configuration upgrades on groups of switches, using a single command line interface (CLI) and switch replacement assistance. It can perform a configuration backup when a switch changes its configuration.</p><p>A Smart Install network consists of exactly one <em>Smart Install Director</em> switch or router, also known as an <em>integrated branch director</em> (IBD), and one or more <em>Smart Install Client</em> switches, also known as <em>integrated branch clients</em> (IBCs). A client switch does not need to be directly connected to the director but can be up to seven hops away.</p><h3 id=\"main-components-of-the-smart-install-network\">Main Components of the Smart Install Network</h3><p>The <em>Director</em> builds a topology database for the network by collecting information from the network Smart Install switches.</p><p>The director uses the database:</p><ul><li>To assign a configuration file and image to a client.</li><li>As a reference to obtain the PID, the image name, and the configuration file for an on-demand update of network switches.</li></ul><p>Smart Install network uses DHCP server to assign IP addresses for transfer of specific parameters.</p><p>Smart Install relies on a TFTP server to store image and configuration files. The TFTP server can be an external device, or the director can act as a TFTP server.</p><p>Client switches have a direct or indirect connection to the director so that they can receive image and configuration downloads from it.</p><h3 id=\"issues-identified\">Issues Identified</h3><p>Knowing the characteristics of the protocol, the researchers have managed to [4]:</p><ul><li>Change the TFTP server address on a client device by sending one malformed TCP packet.</li><li>Copy client's startup-config to the new TFTP server.</li><li>Substitute client's startup-config with another, manually modified one. Client device will then reboot at predefined time.</li><li>Upgrade IOS image on the client device.</li><li>Execute random set of commands on the client device (it is a new feature working only at 3.6.0E and 15.2(2)E IOS versions).</li></ul><p>A proof of concept is available [5].</p><h2 id=\"products-affected\">Products Affected</h2><p>An extensive list (50+) of affected switches and routers can be found in [3].</p><h2 id=\"recommendations\">Recommendations</h2><ul><li>Cisco has updated the Smart Install Description chapter in the <em>Cisco Smart Install Configuration Guide</em> [2] to include <em>Security Best Practices</em> when deploying Cisco Smart Install functionality.</li><li>The protocol does not require authentication by design, and the suggested best practices should be applied depending on how the feature is used in a specific customer environment.</li><li>Organizations that are not leveraging the Smart Install feature, or using it purely for zero-touch deployment, should disable the Smart Install feature once the switch has been deployed with the configuration command <code>no vstack</code>.</li><li>Where the <code>no vstack</code> command is not available (old versions), organizations should ensure that only the IB Director has TCP connectivity to all IB Clients on port 4786, by using: <ul><li>interface access control lists (ACLs),</li><li>Control Plane Policing (CoPP is not available on all Cisco IOS Software releases).</li></ul></li><li>Organizations that are seeking more than just zero-touch deployment, or need the added security of authorization and authentication between the director and clients, can migrate to Cisco Plug-N-Play (PnP).</li><li>Segment the network into multiple zones focusing specifically on separating the management network segment.</li></ul><h3 id=\"mitigations-summary\">Mitigations Summary</h3><table><thead><tr><th><strong>Use Case</strong></th><th><strong>Mitigation</strong></th></tr></thead><tbody><tr><td>- Customers not using the Smart Install feature.</td><td>- Disable (<code>no vstack</code>).</td></tr><tr><td>-----------------------------------------------------------------------------------</td><td>----------------------------------</td></tr><tr><td>- Customers leveraging the Smart Install feature only for zero-touch deployment.</td><td>- Disable (<code>no vstack</code>) after initial deployment.</td></tr><tr><td>-----------------------------------------------------------------------------------</td><td>----------------------------------</td></tr><tr><td>- Customers leveraging the Smart Install feature for more than zero-touch deployment (configuration and image-management).</td><td>- Interface access control lists (ACLs).</td></tr><tr><td>- Customers running old versions.</td><td>- Control Plane Policing (CoPP).</td></tr></tbody></table><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://tools.cisco.com/security/center/content/CiscoSecurityResponse/cisco-sr-20170214-smi\">https://tools.cisco.com/security/center/content/CiscoSecurityResponse/cisco-sr-20170214-smi</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-3750-x-series-switches/white_paper_c11-651895.html\">http://www.cisco.com/c/en/us/products/collateral/switches/catalyst-3750-x-series-switches/white_paper_c11-651895.html</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html#51890\">http://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html#51890</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://2016.zeronights.ru/wp-content/uploads/2016/12/CiscoSmartInstall.v3.pdf\">https://2016.zeronights.ru/wp-content/uploads/2016/12/CiscoSmartInstall.v3.pdf</a></p><p>[5] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/Sab0tag3d/SIET\">https://github.com/Sab0tag3d/SIET</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}