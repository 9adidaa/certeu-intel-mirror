{
  "file_item": {
    "filepath": "security-advisories",
    "filename": "CERT-EU-SA2020-048.pdf"
  },
  "title": "Critical Vulnerability in Microsoft Windows TCP/IP Stack",
  "serial_number": "2020-048",
  "publish_date": "14-10-2020 12:24:00",
  "description": "On 13th of October 2020, Microsoft released several security advisories to address security vulnerabilities. One of the reported vulnerabilities, affects Windows TCP/IP stack. An attacker who successfully exploits this vulnerability could gain the ability to execute code on the target server or client.",
  "url_title": "2020-048",
  "content_markdown": "---\ntitle: 'Critical Vulnerability in Microsoft Windows TCP/IP Stack'\nversion: '1.0'\nnumber: '2020-048'\ndate: 'October 14, 2020'\n---\n\n_History:_\n\n* _14/10/2020 --- v1.0 -- Initial publication_\n\n# Summary\n\nOn 13th of October 2020, Microsoft released several security advisories to address security vulnerabilities. One of the reported vulnerabilities, affects Windows TCP/IP stack. An attacker who successfully exploits this vulnerability could gain the ability to execute code on the target server or client [1].\n\n# Technical Details\n\nThe vulnerability was dubbed _Bad Neighbor_ because it is located within an ICMPv6 Neighbor Discovery Protocol, while using the Router Advertisement type. It has received the CVE-2020-16898 and a CVSS Score of 9.8. To exploit this vulnerability, an attacker would have to send specially crafted ICMPv6 Router Advertisement packets to a remote Windows computer.\n\nThis remote code execution vulnerability exists when the Windows TCP/IP stack improperly handles ICMPv6 Router Advertisement packets that use Option Type 25 (Recursive DNS Server - RDNSS - Option) and a length field value that is even. In this Option, the length is counted in increments of 8 bytes, so an RDNSS option with a length of 3 should have a total length of 24 bytes.\n\nThe option itself consists of five fields: Type, Length, Reserved, Lifetime, and Addresses of IPv6 Recursive DNS Servers. The first four fields have a length of 8 bytes, but the last field can contain a variable number of IPv6 addresses, which are 16 bytes each. As a result, the length field should always be an odd value of at least 3, per RFC 8106.\nWhen an even length value is provided, the Windows TCP/IP stack incorrectly advances the network buffer by an amount that is 8 bytes too few. This is because the stack internally counts in 16-byte increments, failing to account for the case where a non-RFC compliant length value is used. This mismatch results in the stack interpreting the last 8 bytes of the current option as the start of a second option, ultimately leading to a buffer overflow and potential RCE [2].\n\n# Products Affected\n\nWindows 10 (all supported versions), Windows Server 2019, and Windows Server Core (1903, 1909, or 2004) [1, 3].\n\n# Recommendations\n\nInstall the updates mentioned on Microsoft dedicated page [1].\n\n## Mitigations\n\nMicrosoft has not identified any mitigating factors for this vulnerability.\n\n## Workarounds\n\n 1. **Disable IPv6 if possible**\n\n 2. **Disable ICMPv6 RDNSS.**\n\nYou can disable ICMPv6 RDNSS, to prevent attackers from exploiting the vulnerability, with the PowerShell command below. This workaround is only available for Windows 1709 and above.\n\n    netsh int ipv6 set int *INTERFACENUMBER* rabaseddnsconfig=disable\n\nThe workaround can be disabled with the PowerShell command below.\n\n    netsh int ipv6 set int *INTERFACENUMBER* rabaseddnsconfig=enable\n\n>_**Note:** No reboot is needed after enabling/disabling the workaround [1]._\n\n**In all cases, Microsoft strongly recommends that you install the updates for this vulnerability as soon as possible.**\n\n## Detection\n\nSearch in all incoming ICMPv6 traffic for packets with an ICMPv6 Type field of 134 – indicating Router Advertisement – and an ICMPv6 Option field of 25 – indicating Recursive DNS Server (RDNSS). If this RDNSS option also has a length field value that is even, the heuristic would drop or flag the associated packet, as it is likely part of a _Bad Neighbor_ exploit attempt [2].\n\nA Suricata rule is also available [4].\n\n# References\n\n[1] <https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-16898>\n\n[2] <https://www.mcafee.com/blogs/other-blogs/mcafee-labs/cve-2020-16898-bad-neighbor/>\n\n[3] <https://blog.rapid7.com/2020/10/14/there-goes-the-neighborhood-dealing-with-cve-2020-16898-a-k-a-bad-neighbor/>\n\n[4] <https://github.com/advanced-threat-research/CVE-2020-16898>\n",
  "content_html": "<p><em>History:</em></p><ul><li><em>14/10/2020 --- v1.0 -- Initial publication</em></li></ul><h2 id=\"summary\">Summary</h2><p>On 13th of October 2020, Microsoft released several security advisories to address security vulnerabilities. One of the reported vulnerabilities, affects Windows TCP/IP stack. An attacker who successfully exploits this vulnerability could gain the ability to execute code on the target server or client [1].</p><h2 id=\"technical-details\">Technical Details</h2><p>The vulnerability was dubbed <em>Bad Neighbor</em> because it is located within an ICMPv6 Neighbor Discovery Protocol, while using the Router Advertisement type. It has received the CVE-2020-16898 and a CVSS Score of 9.8. To exploit this vulnerability, an attacker would have to send specially crafted ICMPv6 Router Advertisement packets to a remote Windows computer.</p><p>This remote code execution vulnerability exists when the Windows TCP/IP stack improperly handles ICMPv6 Router Advertisement packets that use Option Type 25 (Recursive DNS Server - RDNSS - Option) and a length field value that is even. In this Option, the length is counted in increments of 8 bytes, so an RDNSS option with a length of 3 should have a total length of 24 bytes.</p><p>The option itself consists of five fields: Type, Length, Reserved, Lifetime, and Addresses of IPv6 Recursive DNS Servers. The first four fields have a length of 8 bytes, but the last field can contain a variable number of IPv6 addresses, which are 16 bytes each. As a result, the length field should always be an odd value of at least 3, per RFC 8106. When an even length value is provided, the Windows TCP/IP stack incorrectly advances the network buffer by an amount that is 8 bytes too few. This is because the stack internally counts in 16-byte increments, failing to account for the case where a non-RFC compliant length value is used. This mismatch results in the stack interpreting the last 8 bytes of the current option as the start of a second option, ultimately leading to a buffer overflow and potential RCE [2].</p><h2 id=\"products-affected\">Products Affected</h2><p>Windows 10 (all supported versions), Windows Server 2019, and Windows Server Core (1903, 1909, or 2004) [1, 3].</p><h2 id=\"recommendations\">Recommendations</h2><p>Install the updates mentioned on Microsoft dedicated page [1].</p><h3 id=\"mitigations\">Mitigations</h3><p>Microsoft has not identified any mitigating factors for this vulnerability.</p><h3 id=\"workarounds\">Workarounds</h3><ol><li><p><strong>Disable IPv6 if possible</strong></p></li><li><p><strong>Disable ICMPv6 RDNSS.</strong></p></li></ol><p>You can disable ICMPv6 RDNSS, to prevent attackers from exploiting the vulnerability, with the PowerShell command below. This workaround is only available for Windows 1709 and above.</p><pre><code>netsh int ipv6 set int *INTERFACENUMBER* rabaseddnsconfig=disable\n</code></pre><p>The workaround can be disabled with the PowerShell command below.</p><pre><code>netsh int ipv6 set int *INTERFACENUMBER* rabaseddnsconfig=enable\n</code></pre><blockquote><p><em><strong>Note:</strong> No reboot is needed after enabling/disabling the workaround [1].</em></p></blockquote><p><strong>In all cases, Microsoft strongly recommends that you install the updates for this vulnerability as soon as possible.</strong></p><h3 id=\"detection\">Detection</h3><p>Search in all incoming ICMPv6 traffic for packets with an ICMPv6 Type field of 134 – indicating Router Advertisement – and an ICMPv6 Option field of 25 – indicating Recursive DNS Server (RDNSS). If this RDNSS option also has a length field value that is even, the heuristic would drop or flag the associated packet, as it is likely part of a <em>Bad Neighbor</em> exploit attempt [2].</p><p>A Suricata rule is also available [4].</p><h2 id=\"references\">References</h2><p>[1] <a rel=\"noopener\" target=\"_blank\" href=\"https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-16898\">https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2020-16898</a></p><p>[2] <a rel=\"noopener\" target=\"_blank\" href=\"https://www.mcafee.com/blogs/other-blogs/mcafee-labs/cve-2020-16898-bad-neighbor/\">https://www.mcafee.com/blogs/other-blogs/mcafee-labs/cve-2020-16898-bad-neighbor/</a></p><p>[3] <a rel=\"noopener\" target=\"_blank\" href=\"https://blog.rapid7.com/2020/10/14/there-goes-the-neighborhood-dealing-with-cve-2020-16898-a-k-a-bad-neighbor/\">https://blog.rapid7.com/2020/10/14/there-goes-the-neighborhood-dealing-with-cve-2020-16898-a-k-a-bad-neighbor/</a></p><p>[4] <a rel=\"noopener\" target=\"_blank\" href=\"https://github.com/advanced-threat-research/CVE-2020-16898\">https://github.com/advanced-threat-research/CVE-2020-16898</a></p>",
  "licence": {
    "title": "Creative Commons Attribution 4.0 International (CC-BY 4.0)",
    "link": "https://creativecommons.org/licenses/by/4.0/",
    "restrictions": "https://cert.europa.eu/legal-notice",
    "author": "The Cybersecurity Service for the Union institutions, bodies, offices and agencies"
  }
}